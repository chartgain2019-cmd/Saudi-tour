<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ© - Ù„Ø¹Ø¨Ø© ÙˆØ±Ù‚ ØªÙØ§Ø¹Ù„ÙŠØ©</title>
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ´</text></svg>">
  
  <!-- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap">
  
  <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ø³Ø¨Ù‚ Ù„Ù„ØµÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
  <link rel="preload" as="image" href="https://i.ibb.co/nsGRxS63/1.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/C36ywmnL/3.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/W4vfTNdH/45.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/Hpqc0grL/44.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/FLZ8zWZj/43.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/wNTGb1C9/41.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/6R7kFGQF/42.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/gMQ47K9t/5.png" crossorigin="anonymous">
  <link rel="preload" as="image" href="https://i.ibb.co/twKd4jv1/6.png" crossorigin="anonymous">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  
  <!-- Ø£ØµÙˆØ§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© -->
  <audio id="cardPlaySound" preload="auto">
    <source src="https://files.catbox.moe/rb4nis.wav" type="audio/mpeg">
  </audio>
  <audio id="winSound" preload="auto">
    <source src="https://files.catbox.moe/c0wxkh.wav" type="audio/mpeg">
  </audio>
  <audio id="drawSound" preload="auto">
    <source src="https://files.catbox.moe/d4otc8.wav" type="audio/wav">
  </audio>
  <audio id="notificationSound" preload="auto">
    <source src="https://files.catbox.moe/jwy082.wav" type="audio/wav">
  </audio>
  
  <!-- Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ -->
  <audio id="mainMenuMusic" preload="auto" loop>
    <source src="https://audio-previews.elements.envatousercontent.com/files/101582338/preview.mp3" type="audio/mpeg">
  </audio>
  <audio id="gameplayMusic" preload="auto" loop>
    <source src="https://audio-previews.elements.envatousercontent.com/files/278196402/preview.mp3" type="audio/mpeg">
  </audio>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
    
    * {
      font-family: 'Cairo', sans-serif;
      box-sizing: border-box;
    }
    
    /* Ø´Ø§Ø´Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    #loadingScreen, #imageLoadingScreen {
      transition: opacity 0.5s ease;
    }
    
    /* Ø­Ø±ÙƒØ© Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø´Ø¹Ø§Ø± */
    .logo-spinner {
      animation: logoSpin 2s ease-in-out infinite;
      transform-origin: center;
    }
    
    @keyframes logoSpin {
      0% { transform: rotate(0deg) scale(1); }
      50% { transform: rotate(180deg) scale(1.1); }
      100% { transform: rotate(360deg) scale(1); }
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ */
    .card, .sparkle-particle, .firework-particle, .confetti {
      transform: translateZ(0);
      backface-visibility: hidden;
      perspective: 1000px;
      will-change: transform, opacity;
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ */
    .card {
      width: 135px;
      height: 203px;
      border-radius: 18px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.4);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0;
      border: 6px solid rgba(255, 255, 255, 0.5);
      overflow: hidden;
    }
    
    .card:hover:not(.disabled) {
      transform: translateY(-25px) translateZ(0);
      box-shadow: 0 20px 30px rgba(0,0,0,0.6);
      border-color: #fbbf24;
    }
    
    .card.disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .card.playable {
      border-color: #fbbf24;
      animation: pulse 1.5s infinite;
    }
    
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 14px;
    }
    
    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© */
    .current-card {
      width: 180px;
      height: 270px;
      border-radius: 20px;
      border: 8px solid white;
      box-shadow: 0 15px 35px rgba(0,0,0,0.6);
    }
    
    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† */
    .other-player-card {
      width: 60px;
      height: 90px;
      border-radius: 12px;
      border: 4px solid white;
    }
    
    /* Ø²Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚Ø© */
    .uno-button {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      font-weight: bold;
      font-size: 20px;
      padding: 12px 24px;
      border-radius: 50px;
      border: 4px solid #fbbf24;
      cursor: pointer;
      animation: unoPulse 1.5s infinite;
      box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
      transition: all 0.3s;
    }
    
    .uno-button:hover {
      transform: scale(1.1);
      box-shadow: 0 15px 30px rgba(239, 68, 68, 0.6);
    }
    
    @keyframes unoPulse {
      0%, 100% { 
        box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        transform: scale(1);
      }
      50% { 
        box-shadow: 0 15px 35px rgba(239, 68, 68, 0.7);
        transform: scale(1.05);
      }
    }
    
    /* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
    @keyframes pulse {
      0%, 100% { box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
      50% { box-shadow: 0 10px 35px rgba(251, 191, 36, 0.9); }
    }
    
    @keyframes sparkle {
      0% { opacity: 1; transform: translate(0, 0) scale(1) translateZ(0); }
      100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0) translateZ(0); }
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0) translateZ(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) translateZ(0); }
      20%, 40%, 60%, 80% { transform: translateX(10px) translateZ(0); }
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0) scale(1) translateZ(0); }
      30% { transform: translateY(-40px) scale(1.2) translateZ(0); }
      50% { transform: translateY(0) scale(0.9) translateZ(0); }
      70% { transform: translateY(-20px) scale(1.1) translateZ(0); }
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg) scale(1) translateZ(0); }
      50% { transform: rotate(180deg) scale(1.3) translateZ(0); }
      100% { transform: rotate(360deg) scale(1) translateZ(0); }
    }
    
    @keyframes notifSlide {
      0% { transform: translate(-50%, -100px) translateZ(0); opacity: 0; }
      10% { transform: translate(-50%, 0) translateZ(0); opacity: 1; }
      90% { transform: translate(-50%, 0) translateZ(0); opacity: 1; }
      100% { transform: translate(-50%, -100px) translateZ(0); opacity: 0; }
    }
    
    @keyframes firework {
      0% { 
        transform: translate(0, 0) scale(0) translateZ(0);
        opacity: 1;
      }
      50% {
        opacity: 1;
      }
      100% { 
        transform: translate(var(--tx), var(--ty)) scale(1) translateZ(0);
        opacity: 0;
      }
    }
    
    @keyframes confettiFall {
      0% {
        transform: translateY(-100vh) rotate(0deg) translateZ(0);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg) translateZ(0);
        opacity: 0;
      }
    }
    
    @keyframes superBounce {
      0%, 100% { transform: translateY(0) scale(1) translateZ(0); }
      25% { transform: translateY(-35px) scale(1.15) translateZ(0); }
      50% { transform: translateY(0) scale(0.9) translateZ(0); }
      75% { transform: translateY(-18px) scale(1.1) translateZ(0); }
    }
    
    @keyframes megaSpin {
      0% { transform: rotate(0deg) scale(1) translateZ(0); }
      50% { transform: rotate(180deg) scale(1.4) translateZ(0); }
      100% { transform: rotate(360deg) scale(1) translateZ(0); }
    }
    
    @keyframes pulseGlow {
      0%, 100% {
        box-shadow: 0 0 25px currentColor, 0 0 50px currentColor;
        transform: scale(1) translateZ(0);
      }
      50% {
        box-shadow: 0 0 50px currentColor, 0 0 100px currentColor, 0 0 150px currentColor;
        transform: scale(1.2) translateZ(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes scaleIn {
      0% { transform: scale(0.8) translateZ(0); opacity: 0; }
      100% { transform: scale(1) translateZ(0); opacity: 1; }
    }
    
    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙØµÙˆÙ„ */
    .shake-effect {
      animation: shake 0.5s ease;
    }
    
    .bounce-effect {
      animation: bounce 0.6s ease;
    }
    
    .spin-effect {
      animation: spin 0.6s ease;
    }
    
    .super-bounce-effect {
      animation: superBounce 0.8s ease;
    }
    
    .mega-spin-effect {
      animation: megaSpin 1s ease;
    }
    
    .pulse-glow-effect {
      animation: pulseGlow 1.5s ease infinite;
    }
    
    /* Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© */
    .sparkle-effect {
      position: fixed;
      pointer-events: none;
      z-index: 9999;
    }
    
    .sparkle-particle {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      animation: sparkle 1s ease-out forwards;
    }
    
    .firework-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }
    
    .firework-particle {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      animation: firework 1.5s ease-out forwards;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confettiFall 3s linear forwards;
    }
    
    .star-burst {
      position: absolute;
      font-size: 54px;
      animation: starBurst 1.5s ease-out forwards;
    }
    
    /* Ø£Ø²Ø±Ø§Ø± ÙˆØ¥Ø´Ø¹Ø§Ø±Ø§Øª */
    .notification {
      position: fixed;
      top: 25px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(30,30,30,0.95) 100%);
      color: white;
      padding: 18px 36px;
      border-radius: 18px;
      font-size: 20px;
      font-weight: 700;
      z-index: 1000;
      animation: notifSlide 3s ease;
      box-shadow: 0 12px 45px rgba(0,0,0,0.6), 0 0 25px rgba(102, 126, 234, 0.4);
      border: 3px solid rgba(102, 126, 234, 0.4);
    }
    
    .permanent-notification {
      animation: none !important;
      position: fixed !important;
      top: 20px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      z-index: 9999 !important;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      animation: fadeIn 0.3s ease;
      overflow-y: auto;
      padding: 25px;
    }
    
    .modal-content {
      background: white;
      padding: 28px;
      border-radius: 22px;
      text-align: center;
      max-width: 550px;
      width: 92%;
      animation: scaleIn 0.3s ease;
      max-height: 92%;
      overflow-y: auto;
    }
    
    .color-btn, .city-btn {
      padding: 14px 28px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      border: none;
      color: white;
      font-size: 18px;
    }
    
    .color-btn:hover, .city-btn:hover {
      transform: scale(1.08) translateZ(0);
    }
    
    .glow-text {
      text-shadow: 0 0 15px currentColor, 0 0 30px currentColor;
    }
    
    .player-box {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(12px);
      border-radius: 14px;
      padding: 14px;
      transition: all 0.3s;
    }
    
    .player-box.active {
      background: rgba(251, 191, 36, 0.35);
      border: 4px solid #fbbf24;
      box-shadow: 0 0 25px rgba(251, 191, 36, 0.6);
    }
    
    .player-select-btn.selected {
      background: linear-gradient(to right, #3b82f6, #2563eb) !important;
      border-color: #1d4ed8 !important;
      color: white !important;
    }
    
    .player-input-box {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.12) 0%, rgba(118, 75, 162, 0.12) 100%);
      border: 3px solid rgba(102, 126, 234, 0.35);
      border-radius: 14px;
      padding: 18px;
      transition: all 0.3s;
    }
    
    .icon-option {
      width: 54px;
      height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s;
      border: 4px solid transparent;
      background: #f3f4f6;
    }
    
    .icon-option:hover {
      transform: scale(1.18) translateZ(0);
      background: #e5e7eb;
    }
    
    .icon-option.selected {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.15);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
    }
    
    .custom-image-icon {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }
    
    .upload-icon-btn {
      width: 54px;
      height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s;
      border: 4px dashed #667eea;
      background: rgba(102, 126, 234, 0.15);
    }
    
    .upload-icon-btn:hover {
      background: rgba(102, 126, 234, 0.25);
      transform: scale(1.05);
    }
    
    .stats-card {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
      border: 3px solid rgba(102, 126, 234, 0.25);
      border-radius: 14px;
      padding: 18px;
      margin: 10px 0;
    }
    
    .leaderboard-entry {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px;
      margin: 10px 0;
      background: white;
      border-radius: 14px;
      border: 3px solid #e5e7eb;
      transition: all 0.3s;
    }
    
    .leaderboard-entry.first {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      font-weight: bold;
    }
    
    .leaderboard-entry.second {
      background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
    }
    
    .leaderboard-entry.third {
      background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
      color: white;
    }
    
    .achievement-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 10px 20px;
      border-radius: 24px;
      font-size: 16px;
      font-weight: 600;
      margin: 5px;
      box-shadow: 0 6px 12px rgba(251, 191, 36, 0.35);
    }
    
    .achievement-badge.locked {
      background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
      opacity: 0.6;
    }
    
    .game-mode-btn {
      padding: 18px 28px;
      border-radius: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: 4px solid transparent;
      text-align: center;
    }
    
    .game-mode-btn.selected {
      border-color: #667eea;
      box-shadow: 0 0 25px rgba(102, 126, 234, 0.45);
    }
    
    .match-history-item {
      background: white;
      border-radius: 14px;
      padding: 18px;
      margin: 10px 0;
      border: 3px solid #e5e7eb;
      transition: all 0.3s;
    }
    
    .match-history-item.win {
      border-color: #10b981;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.07) 0%, rgba(5, 150, 105, 0.07) 100%);
    }
    
    .match-history-item.loss {
      border-color: #ef4444;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.07) 0%, rgba(220, 38, 38, 0.07) 100%);
    }
    
    .ai-thinking {
      animation: pulse 1.5s infinite;
    }
    
    /* Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© */
    .help-button {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.35);
      transition: all 0.3s;
    }
    
    .help-button:hover {
      transform: scale(1.12) translateZ(0);
      box-shadow: 0 8px 22px rgba(37, 99, 235, 0.45);
    }
    
    /* Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    .start-btn-loading {
      position: relative;
    }
    
    .start-btn-loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 28px;
      height: 28px;
      border: 3px solid rgba(255, 255, 255, 0.35);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    /* Ø²Ø± Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ */
    .music-button {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.35);
      transition: all 0.3s;
      z-index: 40;
    }
    
    .music-button.muted {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 6px 18px rgba(239, 68, 68, 0.35);
    }
    
    .music-button:hover {
      transform: scale(1.12) translateZ(0);
    }
    
    /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
    .connection-status {
      position: fixed;
      top: 10px;
      right: 10px;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.2);
    }
    
    .connection-status.connected {
      background: rgba(16, 185, 129, 0.9);
    }
    
    .connection-status.disconnected {
      background: rgba(239, 68, 68, 0.9);
    }
    
    .connection-status.connecting {
      background: rgba(245, 158, 11, 0.9);
    }
    
    /* ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© */
    .room-code {
      font-family: 'Courier New', monospace;
      letter-spacing: 3px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    /* ØªØ£Ø«ÙŠØ± Ø§Ù‡ØªØ²Ø§Ø² Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    @keyframes inputError {
      0%, 100% { transform: translateX(0) translateZ(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) translateZ(0); }
      20%, 40%, 60%, 80% { transform: translateX(5px) translateZ(0); }
    }
    
    .input-error {
      animation: inputError 0.5s ease;
      border-color: #ef4444 !important;
      background-color: #fef2f2 !important;
    }
    
    /* Ù…ÙØªØ§Ø­ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: #2196F3;
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }
    
    /* Ø´Ø±ÙŠØ· ØªÙ‚Ø¯Ù… Ø§Ù„Ù‚ÙˆØ© */
    .strength-bar {
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .strength-level {
      height: 100%;
      transition: width 0.5s ease;
    }
    
    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØµÙˆØ± Ø§Ù„Ø±Ù…Ø²ÙŠØ© */
    .avatar-container {
      position: relative;
      overflow: hidden;
      border: 4px solid transparent;
      transition: all 0.3s ease;
    }
    
    .avatar-container:hover {
      border-color: #667eea;
      transform: scale(1.05);
    }
    
    .avatar-badge {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #10b981;
      color: white;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid white;
    }
    
    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ÙØ´Ù„ */
    .success-message {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
      animation: fadeIn 0.3s ease;
    }
    
    .error-message {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
      animation: fadeIn 0.3s ease;
    }
    
    .warning-message {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
      padding: 15px;
      border-radius: 12px;
      margin: 10px 0;
      animation: fadeIn 0.3s ease;
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    @media (max-width: 768px) {
      .card {
        width: 110px;
        height: 165px;
      }
      
      .current-card {
        width: 150px;
        height: 225px;
      }
      
      .other-player-card {
        width: 50px;
        height: 75px;
      }
      
      .notification {
        padding: 14px 24px;
        font-size: 18px;
        top: 15px;
      }
      
      .uno-button {
        font-size: 16px;
        padding: 10px 20px;
      }
      
      .music-button {
        width: 50px;
        height: 50px;
        font-size: 24px;
      }
      
      .connection-status {
        top: 5px;
        right: 5px;
        font-size: 12px;
        padding: 6px 12px;
      }
    }
    
    @media (max-width: 480px) {
      .card {
        width: 95px;
        height: 143px;
      }
      
      .current-card {
        width: 130px;
        height: 195px;
      }
      
      .other-player-card {
        width: 45px;
        height: 68px;
      }
      
      .uno-button {
        font-size: 14px;
        padding: 8px 16px;
      }
      
      .music-button {
        width: 46px;
        height: 46px;
        font-size: 22px;
      }
      
      .connection-status {
        font-size: 11px;
        padding: 4px 8px;
      }
    }
    
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙƒØ¨Ø±Ø© */
    #playerHand {
      gap: 20px;
      padding: 25px;
    }
    
    .card-container {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    
    #playerHand .card {
      margin: 0 12px 15px;
    }
  </style>
</head>
<body class="h-full">
  <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="loadingScreen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="mb-6 flex justify-center">
        <img src="https://i.ibb.co/nsGRxS63/1.png" alt="Ø´Ø¹Ø§Ø± Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©" class="w-40 h-auto logo-spinner">
      </div>
      <div class="w-20 h-20 border-6 border-white border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
      <p class="text-white text-3xl font-bold mb-3">Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
      <p class="text-white opacity-80 text-lg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©...</p>
    </div>
  </div>
  
  <!-- Ø´Ø§Ø´Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± -->
  <div id="imageLoadingScreen" class="fixed inset-0 bg-gradient-to-br from-green-600 to-blue-600 flex items-center justify-center z-45 hidden">
    <div class="text-center">
      <div class="w-24 h-24 border-6 border-white border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
      <p class="text-white text-3xl font-bold mb-3">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±...</p>
      <div class="w-80 bg-white bg-opacity-20 rounded-full h-6 mx-auto mb-3 overflow-hidden">
        <div id="imageProgressBar" class="h-full bg-gradient-to-r from-yellow-400 to-green-500 image-loading-progress" style="width: 0%"></div>
      </div>
      <p id="imageProgressText" class="text-white text-xl">0%</p>
      <p id="imageStatusText" class="text-white opacity-80 mt-3 text-lg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</p>
    </div>
  </div>
  
  <!-- ========== Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== -->
  
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="loginScreen" class="hidden fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-3xl p-8 md:p-10 shadow-2xl text-center max-w-md w-full">
      <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© -->
      <div class="mb-8 flex justify-center">
        <img src="https://i.ibb.co/nsGRxS63/1.png" alt="Ø´Ø¹Ø§Ø± Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©" class="w-60 h-auto">
      </div>
      
      <h2 class="text-3xl font-bold mb-2" style="color: #667eea;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ!</h2>
      <p class="text-gray-600 mb-8 text-lg">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ù…ØºØ§Ù…Ø±ØªÙƒ</p>
      
      <div class="space-y-5">
        <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="loginEmail" 
                 class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                 placeholder="example@email.com"
                 required>
          <div id="loginEmailError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="relative">
            <input type="password" id="loginPassword" 
                   class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all pr-12"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   required>
            <button type="button" onclick="togglePasswordVisibility('loginPassword')" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
              ğŸ‘ï¸
            </button>
          </div>
          <div id="loginPasswordError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- Ø®ÙŠØ§Ø± ØªØ°ÙƒØ±Ù†ÙŠ -->
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <input type="checkbox" id="rememberMe" class="w-5 h-5 rounded">
            <label for="rememberMe" class="mr-2 text-gray-700 font-medium">ØªØ°ÙƒØ±Ù†ÙŠ</label>
          </div>
          <button onclick="showForgotPassword()" class="text-blue-600 hover:text-blue-800 font-medium text-lg">
            Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ
          </button>
        </div>
        
        <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <button onclick="loginUser()" 
                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white text-2xl font-bold py-5 px-10 rounded-2xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-xl mb-4">
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ğŸš€
        </button>
        
        <!-- Ø£ÙˆØ§ØµÙ„ ÙƒØ¶ÙŠÙ -->
        <button onclick="continueAsGuest()" 
                class="w-full bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-gray-500 hover:to-gray-600 transition-all transform hover:scale-105 shadow-xl mb-6">
          Ø£Ù„Ø¹Ø¨ ÙƒØ¶ÙŠÙ ğŸ‘¤
        </button>
        
        <!-- Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
        <div class="border-t pt-6">
          <p class="text-gray-600 mb-4">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</p>
          <button onclick="showRegisterScreen()" 
                  class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-xl">
            Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ âœ¨
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø´Ø§Ø´Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ -->
  <div id="registerScreen" class="hidden fixed inset-0 bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-3xl p-8 md:p-10 shadow-2xl text-center max-w-md w-full">
      <div class="flex justify-between items-center mb-8">
        <button onclick="showLoginScreen()" class="text-gray-500 hover:text-gray-700 text-2xl">
          â†
        </button>
        <h2 class="text-3xl font-bold flex-1" style="color: #764ba2;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      </div>
      
      <p class="text-gray-600 mb-8 text-lg">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…ØºØ§Ù…Ø±ØªÙ†Ø§ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</p>
      
      <div class="space-y-5">
        <!-- Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
          <input type="text" id="registerName" 
                 class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                 placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"
                 required>
          <div id="registerNameError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="registerEmail" 
                 class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all"
                 placeholder="example@email.com"
                 required>
          <div id="registerEmailError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="relative">
            <input type="password" id="registerPassword" 
                   class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all pr-12"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   required>
            <button type="button" onclick="togglePasswordVisibility('registerPassword')" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
              ğŸ‘ï¸
            </button>
          </div>
          <div id="registerPasswordError" class="text-red-600 text-sm mt-2 hidden"></div>
          <div class="mt-2">
            <div class="flex items-center mb-1">
              <div id="passwordStrength" class="h-2 flex-1 bg-gray-200 rounded-full overflow-hidden">
                <div id="passwordStrengthBar" class="h-full transition-all duration-500" style="width: 0%"></div>
              </div>
              <span id="passwordStrengthText" class="mr-3 text-sm font-medium">Ø¶Ø¹ÙŠÙØ©</span>
            </div>
            <ul class="text-sm text-gray-600 text-right space-y-1">
              <li id="lengthReq" class="text-red-500">â€¢ 8 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</li>
              <li id="numberReq" class="text-red-500">â€¢ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù‚Ù…</li>
              <li id="upperReq" class="text-red-500">â€¢ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø­Ø±Ù ÙƒØ¨ÙŠØ±</li>
              <li id="specialReq" class="text-red-500">â€¢ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø®Ø§Øµ</li>
            </ul>
          </div>
        </div>
        
        <!-- ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <div class="relative">
            <input type="password" id="registerConfirmPassword" 
                   class="w-full p-4 border-3 border-gray-300 rounded-xl text-lg focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition-all pr-12"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   required>
            <button type="button" onclick="togglePasswordVisibility('registerConfirmPassword')" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
              ğŸ‘ï¸
            </button>
          </div>
          <div id="registerConfirmPasswordError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© -->
        <div class="flex items-center">
          <input type="checkbox" id="acceptTerms" class="w-5 h-5 rounded" required>
          <label for="acceptTerms" class="mr-2 text-gray-700 font-medium text-sm">
            Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ 
            <button type="button" onclick="showTermsModal()" class="text-blue-600 hover:text-blue-800">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</button>
            Ùˆ
            <button type="button" onclick="showPrivacyModal()" class="text-blue-600 hover:text-blue-800">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</button>
          </label>
        </div>
        
        <!-- Ø²Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ -->
        <button onclick="registerUser()" 
                class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white text-2xl font-bold py-5 px-10 rounded-2xl hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 shadow-xl mb-4">
          Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ¨
        </button>
        
        <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨Ø§Øª Ø£Ø®Ø±Ù‰ -->
        <div class="border-t pt-6">
          <p class="text-gray-600 mb-4">Ø£Ùˆ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…</p>
          <div class="grid grid-cols-2 gap-4">
            <button onclick="loginWithGoogle()" 
                    class="bg-gradient-to-r from-red-500 to-red-600 text-white font-bold py-3 px-6 rounded-xl hover:from-red-600 hover:to-red-700 transition-all transform hover:scale-105">
              Google
            </button>
            <button onclick="loginWithApple()" 
                    class="bg-gradient-to-r from-gray-700 to-gray-800 text-white font-bold py-3 px-6 rounded-xl hover:from-gray-800 hover:to-gray-900 transition-all transform hover:scale-105">
              Apple
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø´Ø§Ø´Ø© Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
  <div id="forgotPasswordScreen" class="hidden fixed inset-0 bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-3xl p-8 md:p-10 shadow-2xl text-center max-w-md w-full">
      <div class="flex justify-between items-center mb-8">
        <button onclick="showLoginScreen()" class="text-gray-500 hover:text-gray-700 text-2xl">
          â†
        </button>
        <h2 class="text-3xl font-bold flex-1" style="color: #ea580c;">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h2>
      </div>
      
      <div class="text-5xl mb-6">ğŸ”</div>
      <p class="text-gray-600 mb-8 text-lg">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</p>
      
      <div class="space-y-5">
        <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
          <input type="email" id="forgotEmail" 
                 class="w-full p-4 border-3 border-orange-300 rounded-xl text-lg focus:border-orange-500 focus:ring-2 focus:ring-orange-200 outline-none transition-all"
                 placeholder="example@email.com"
                 required>
          <div id="forgotEmailError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† -->
        <button onclick="sendResetLink()" 
                class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white text-2xl font-bold py-5 px-10 rounded-2xl hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-xl mb-4">
          Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø© ğŸ”—
        </button>
        
        <!-- Ø¥Ø´Ø¹Ø§Ø± Ù…Ù‡Ù… -->
        <div class="bg-yellow-50 border-3 border-yellow-200 rounded-xl p-4 text-right">
          <p class="text-yellow-800 font-bold mb-2">âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©</p>
          <p class="text-yellow-700 text-sm">
            Ø³ØªØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø®Ù„Ø§Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø³Ø±ÙŠ Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.
            Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·.
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ø´Ø§Ø´Ø© Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
  <div id="resetPasswordScreen" class="hidden fixed inset-0 bg-gradient-to-br from-green-600 to-teal-600 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-3xl p-8 md:p-10 shadow-2xl text-center max-w-md w-full">
      <div class="flex justify-between items-center mb-8">
        <button onclick="showLoginScreen()" class="text-gray-500 hover:text-gray-700 text-2xl">
          â†
        </button>
        <h2 class="text-3xl font-bold flex-1" style="color: #059669;">ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©</h2>
      </div>
      
      <div class="text-5xl mb-6">ğŸ”‘</div>
      <p class="text-gray-600 mb-8 text-lg">Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ù‚ÙˆÙŠØ© Ù„Ø­Ù…Ø§ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ</p>
      
      <div class="space-y-5">
        <!-- ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
          <div class="relative">
            <input type="password" id="resetNewPassword" 
                   class="w-full p-4 border-3 border-green-300 rounded-xl text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all pr-12"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   required>
            <button type="button" onclick="togglePasswordVisibility('resetNewPassword')" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
              ğŸ‘ï¸
            </button>
          </div>
          <div id="resetNewPasswordError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="text-right">
          <label class="block text-gray-700 font-bold mb-2 text-lg">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
          <div class="relative">
            <input type="password" id="resetConfirmPassword" 
                   class="w-full p-4 border-3 border-green-300 rounded-xl text-lg focus:border-green-500 focus:ring-2 focus:ring-green-200 outline-none transition-all pr-12"
                   placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                   required>
            <button type="button" onclick="togglePasswordVisibility('resetConfirmPassword')" 
                    class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
              ğŸ‘ï¸
            </button>
          </div>
          <div id="resetConfirmPasswordError" class="text-red-600 text-sm mt-2 hidden"></div>
        </div>
        
        <!-- Ø²Ø± ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <button onclick="resetPassword()" 
                class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white text-2xl font-bold py-5 px-10 rounded-2xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-xl mb-4">
          ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ”„
        </button>
        
        <!-- Ù…Ø¤Ø´Ø± Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
        <div class="bg-gray-50 rounded-xl p-4">
          <p class="text-gray-700 font-bold mb-3">ğŸ“Š Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</p>
          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <span class="text-sm text-gray-600">Ø¶Ø¹ÙŠÙØ©</span>
              <span class="text-sm text-gray-600">Ù…ØªÙˆØ³Ø·Ø©</span>
              <span class="text-sm text-gray-600">Ù‚ÙˆÙŠØ©</span>
              <span class="text-sm text-gray-600">Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹</span>
            </div>
            <div class="h-3 bg-gray-200 rounded-full overflow-hidden">
              <div id="resetPasswordStrengthBar" class="h-full transition-all duration-500" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Ù†Ø§ÙØ°Ø© Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© -->
  <div id="termsModal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-60">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
      <h2 class="text-2xl font-bold mb-6 text-center">ğŸ“œ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</h2>
      <div class="space-y-4 text-right">
        <p>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„Ø¹Ø¨Ø© "Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©". Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„ØªØ§Ù„ÙŠØ©:</p>
        
        <h3 class="font-bold text-lg">1. Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´Ø±ÙˆØ·</h3>
        <p>Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù„Ø¹Ø¨Ø©ØŒ ÙØ¥Ù†Ùƒ ØªØ¤ÙƒØ¯ Ø£Ù†Ùƒ Ù‚Ø¯ Ù‚Ø±Ø£Øª ÙˆÙÙ‡Ù…Øª ÙˆÙˆØ§ÙÙ‚Øª Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·.</p>
        
        <h3 class="font-bold text-lg">2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <p>â€¢ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 13 Ø³Ù†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨.<br>
           â€¢ Ø£Ù†Øª Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø±ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ.<br>
           â€¢ ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØµØ­ÙŠØ­Ø©.</p>
        
        <h3 class="font-bold text-lg">3. Ø³Ù„ÙˆÙƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <p>ÙŠÙ…Ù†Ø¹ Ù…Ù†Ø¹Ø§Ù‹ Ø¨Ø§ØªØ§Ù‹:<br>
           â€¢ Ø§Ù„ØªØµØ±Ù Ø¨Ø·Ø±ÙŠÙ‚Ø© ØºÙŠØ± Ù„Ø§Ø¦Ù‚Ø©.<br>
           â€¢ Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚ Ø£Ùˆ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ø¨Ù‡.<br>
           â€¢ Ø¥Ø±Ø³Ø§Ù„ Ù…Ø­ØªÙˆÙ‰ Ø¶Ø§Ø± Ø£Ùˆ ØºÙŠØ± Ù‚Ø§Ù†ÙˆÙ†ÙŠ.</p>
        
        <h3 class="font-bold text-lg">4. Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ©</h3>
        <p>Ø¬Ù…ÙŠØ¹ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆØ¸Ø©. Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ù†Ø³Ø® Ø£Ùˆ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¯ÙˆÙ† Ø¥Ø°Ù†.</p>
        
        <button onclick="closeTermsModal()" class="w-full mt-8 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 px-8 rounded-xl">
          ÙÙ‡Ù…Øª ÙˆÙˆØ§ÙÙ‚Øª âœ…
        </button>
      </div>
    </div>
  </div>
  
  <!-- Ù†Ø§ÙØ°Ø© Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© -->
  <div id="privacyModal" class="hidden fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-60">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
      <h2 class="text-2xl font-bold mb-6 text-center">ğŸ”’ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h2>
      <div class="space-y-4 text-right">
        <p>Ù†Ø­Ù† Ù†Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØªÙƒ. ØªØ´Ø±Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙƒÙŠÙÙŠØ© Ø¬Ù…Ø¹ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ.</p>
        
        <h3 class="font-bold text-lg">1. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ Ù†Ø¬Ù…Ø¹Ù‡Ø§</h3>
        <p>â€¢ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„.<br>
           â€¢ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª.<br>
           â€¢ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„.</p>
        
        <h3 class="font-bold text-lg">2. ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
        <p>â€¢ ØªÙ‚Ø¯ÙŠÙ… ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ø®Ø¯Ù…Ø©.<br>
           â€¢ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ.<br>
           â€¢ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø£Ù…Ø§Ù† Ø§Ù„Ø­Ø³Ø§Ø¨.<br>
           â€¢ ØªØ­Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©.</p>
        
        <h3 class="font-bold text-lg">3. Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
        <p>â€¢ Ù†Ø³ØªØ®Ø¯Ù… ØªØ´ÙÙŠØ±Ø§Ù‹ Ù…ØªÙ‚Ø¯Ù…Ø§Ù‹ Ù„Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.<br>
           â€¢ Ù†Ù‚ÙˆÙ… Ø¨ØªØ®Ø²ÙŠÙ† ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†.<br>
           â€¢ Ù†ØªØ¨Ø¹ Ø£ÙØ¶Ù„ Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†.</p>
        
        <h3 class="font-bold text-lg">4. Ø­Ù‚ÙˆÙ‚Ùƒ</h3>
        <p>â€¢ Ø§Ù„Ø­Ù‚ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.<br>
           â€¢ Ø§Ù„Ø­Ù‚ ÙÙŠ ØªØµØ­ÙŠØ­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.<br>
           â€¢ Ø§Ù„Ø­Ù‚ ÙÙŠ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ.</p>
        
        <button onclick="closePrivacyModal()" class="w-full mt-8 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-3 px-8 rounded-xl">
          ÙÙ‡Ù…Øª ÙˆÙˆØ§ÙÙ‚Øª âœ…
        </button>
      </div>
    </div>
  </div>
  
  <!-- Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="userStatusBar" class="hidden fixed top-8 right-8 z-40">
    <div class="bg-white bg-opacity-90 backdrop-blur-sm rounded-2xl p-4 shadow-2xl flex items-center gap-4">
      <div id="userAvatar" class="w-14 h-14 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-2xl font-bold text-white">
        ğŸ‘¤
      </div>
      <div class="text-right">
        <p id="userName" class="font-bold text-lg text-gray-800">Ø§Ù„Ø¶ÙŠÙ</p>
        <p id="userEmail" class="text-sm text-gray-600">ØºÙŠØ± Ù…Ø³Ø¬Ù„</p>
        <p id="userPoints" class="text-xs text-yellow-600 font-bold">0 Ù†Ù‚Ø·Ø©</p>
      </div>
      <button onclick="toggleUserMenu()" class="text-gray-500 hover:text-gray-700 text-2xl">
        âš™ï¸
      </button>
    </div>
  </div>
  
  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="userMenu" class="hidden fixed top-28 right-8 z-40 bg-white rounded-2xl shadow-2xl w-64 p-4">
    <div class="space-y-3">
      <div class="text-center border-b pb-3 mb-3">
        <p class="font-bold text-lg text-gray-800" id="menuUserName">Ø§Ù„Ø¶ÙŠÙ</p>
        <p class="text-sm text-gray-500" id="menuUserEmail">ØºÙŠØ± Ù…Ø³Ø¬Ù„</p>
      </div>
      
      <button onclick="showProfile()" class="w-full text-right p-3 hover:bg-gray-100 rounded-xl flex items-center justify-between">
        <span>ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
        <span class="text-gray-400">â†’</span>
      </button>
      
      <button onclick="showStats()" class="w-full text-right p-3 hover:bg-gray-100 rounded-xl flex items-center justify-between">
        <span>ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
        <span class="text-gray-400">â†’</span>
      </button>
     
      <div class="border-t pt-3 mt-3">
        <button onclick="logoutUser()" class="w-full text-right p-3 hover:bg-red-50 text-red-600 rounded-xl flex items-center justify-between">
          <span>ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
          <span class="text-red-400">â†’</span>
        </button>
      </div>
    </div>
  </div>
  
  <!-- ========== Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== -->
  
  <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
  <div id="connectionStatus" class="connection-status hidden">
    <div class="w-3 h-3 rounded-full bg-gray-400"></div>
    <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
  </div>
  
  <!-- Ø²Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
  <div id="helpButton" class="fixed bottom-8 left-8 z-40 help-button hidden" onclick="showHelp()">
    ØŸ
  </div>
  
  <!-- Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) -->
  <button id="musicToggleMain" onclick="toggleMusic()" 
          class="fixed top-8 left-8 music-button hidden z-40" 
          title="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰">
    ğŸ”Š
  </button>
  
  <!-- Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ (Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨) -->
  <button id="musicToggleGame" onclick="toggleMusic()" 
          class="fixed bottom-8 right-8 music-button hidden z-40" 
          title="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰">
    ğŸ”Š
  </button>
  
  <div id="app" class="h-full w-full overflow-auto" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© -->
    <div id="startScreen" class="h-full flex items-center justify-center p-6">
      <div class="bg-white rounded-3xl p-10 shadow-2xl text-center max-w-lg w-full">
        <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø© -->
        <div class="mb-8 flex justify-center">
          <img src="https://i.ibb.co/nsGRxS63/1.png" alt="Ø´Ø¹Ø§Ø± Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©" class="w-80 h-auto">
        </div>
        
        <p class="text-gray-600 mb-10 text-xl">Ù„Ø¹Ø¨Ø© ÙˆØ±Ù‚ ØªÙØ§Ø¹Ù„ÙŠØ©</p>
        
        <!-- Ø§Ø®ØªÙŠØ§Ø± ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨ -->
        <div class="mb-8">
          <label class="block text-gray-700 font-bold mb-4 text-xl">ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨:</label>
          <div class="grid grid-cols-2 gap-4">
            <div id="mode-ai" onclick="selectGameMode('ai')" class="game-mode-btn selected bg-gradient-to-r from-purple-500 to-purple-600 text-white">
              <div class="text-4xl mb-3">ğŸ¤–</div>
              <div class="font-bold text-lg">Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</div>
            </div>
            <div id="mode-online" onclick="selectGameMode('online')" class="game-mode-btn bg-gradient-to-r from-blue-500 to-purple-600 text-white">
              <div class="text-4xl mb-3">ğŸŒ</div>
              <div class="font-bold text-lg">Ù„Ø¹Ø¨ Ø¬Ù…Ø§Ø¹ÙŠ</div>
            </div>
          </div>
        </div>
        
        <div id="playerCountSection" class="mb-8">
          <label class="block text-gray-700 font-bold mb-4 text-xl">Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†:</label>
          <div class="grid grid-cols-1 gap-4">
            <button onclick="selectPlayers(2)" id="players-2" class="player-select-btn selected bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-6 rounded-2xl transition-all transform hover:scale-110 border-5 text-lg"> 2 Ù„Ø§Ø¹Ø¨ÙŠÙ† </button>
          </div>
        </div>
        
        <button onclick="handleStartButton()" id="startGameButton" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white text-2xl font-bold py-5 px-10 rounded-2xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-110 shadow-xl mb-4 relative">
          <span id="startButtonText">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</span>
        </button>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
          <button onclick="showLeaderboard()" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-110 shadow-xl"> ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† </button>
          <button onclick="showAchievements()" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-yellow-600 hover:to-yellow-700 transition-all transform hover:scale-110 shadow-xl"> ğŸ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª </button>
        </div>
        
        <button onclick="showMatchHistory()" class="w-full bg-gradient-to-r from-indigo-500 to-indigo-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-indigo-600 hover:to-indigo-700 transition-all transform hover:scale-110 shadow-xl"> ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª </button>
      </div>
    </div>
    
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ -->
    <div id="namesScreen" class="hidden h-full flex items-center justify-center p-6">
      <div class="bg-white rounded-3xl p-10 shadow-2xl text-center max-w-lg w-full">
        <h2 class="text-4xl font-bold mb-3" style="color: #667eea;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
        <p class="text-gray-600 mb-8 text-lg">Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</p>
        
        <div id="playerInputs" class="space-y-6 mb-8">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
        
        <div class="flex gap-4">
          <button onclick="backToStart()" class="flex-1 bg-gray-300 text-gray-700 text-xl font-bold py-4 px-8 rounded-2xl hover:bg-gray-400 transition-all transform hover:scale-105"> Ø±Ø¬ÙˆØ¹ </button>
          <button onclick="startGameWithNames()" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 shadow-xl"> Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ </button>
        </div>
      </div>
    </div>
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div id="gameScreen" class="hidden h-full flex flex-col p-6">
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† -->
      <div id="otherPlayersArea" class="mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„ÙˆØ³Ø·Ù‰ -->
      <div class="flex-1 flex items-center justify-center gap-12 my-6 flex-wrap">
        <!-- ÙƒÙˆÙ…Ø© Ø§Ù„Ø³Ø­Ø¨ -->
        <div class="text-center">
          <div id="drawPile" onclick="drawCard()" class="card cursor-pointer hover:scale-110" style="border: 6px solid white;">
            <img src="https://i.ibb.co/C36ywmnL/3.png" alt="Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©">
          </div>
          <p class="text-white mt-3 font-bold text-lg"><span id="drawPileCount">82</span> Ø¨Ø·Ø§Ù‚Ø©</p>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div class="text-center">
          <div id="currentCard" class="card current-card">
            <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
          </div>
          <p class="text-white mt-3 font-bold text-xl">Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
        </div>
        
        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø¯ÙˆØ± -->
        <div class="text-center bg-white bg-opacity-25 backdrop-blur-sm rounded-2xl p-6">
          <p class="text-white text-base mb-3">Ø¯ÙˆØ±:</p>
          <p id="turnIndicator" class="text-yellow-300 font-bold text-3xl glow-text">Ø£Ù†Øª</p>
          <div id="directionIndicator" class="text-white text-4xl mt-3">â†“</div>
        </div>
      </div>
      
      <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ -->
      <div class="mt-auto">
        <div class="bg-white bg-opacity-25 backdrop-blur-sm rounded-2xl p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div id="currentPlayerIcon" class="bg-green-500 text-white w-16 h-16 rounded-full flex items-center justify-center font-bold text-2xl">
                ğŸ‘¤
              </div>
              <div>
                <p id="playerNameLabel" class="text-white font-bold text-xl">Ø£Ù†Øª</p>
                <p class="text-white text-base">Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ: <span id="playerCardCount" class="font-bold">5</span></p>
              </div>
            </div>
            
            <!-- Ø²Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚Ø© -->
            <button id="unoButton" class="uno-button hidden" onclick="announceUno()">
              ğŸ¯ Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚Ø©!
            </button>
          </div>
          
          <div id="playerHand" class="card-container">
            <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¨Ø´Ø±ÙŠ -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ====================
    const defaultConfig = {
      game_title: "Ø¬ÙˆÙ„Ø© Ø³Ø¹ÙˆØ¯ÙŠØ©"
    };
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
    let allPlayerStats = [];
    let isDataSdkInitialized = false;
    let selectedPlayerCount = 2;
    let playerNames = [];
    let gameMode = "ai";
    let selectedPlayerIcons = [];
    let customPlayerImages = {};
    let tempUploadFile = null;
    let activeEffects = new Set();
    let isLowPerfDevice = false;
    
    // Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ø¹ÙŠØ¯
    const SERVER_URL = "https://saudi-tour.onrender.com";

    // Ù…ØªØºÙŠØ±Ø§Øª Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    let currentUser = null;
    let usersDatabase = {};
    let resetTokens = {};
    let sessionTimeout = null;
    
    // Ù…ØªØºÙŠØ±Ø§Øª ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±
    let totalImagesToLoad = 0;
    let loadedImagesCount = 0;
    let allImagesLoaded = false;
    let imageLoadingScreen = null;
    let imageProgressBar = null;
    let imageProgressText = null;
    let imageStatusText = null;
    
    let gameState = {
      deck: [],
      players: [],
      currentCard: null,
      currentPlayerIndex: 0,
      direction: 1,
      drawPileCards: 0,
      totalPlayers: 2,
      aiThinking: false
    };
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¨Ø³Ø·
    let socket = null;
    let onlinePlayers = [];
    let onlineGameState = null;
    let isSearchingForGame = false;
    let waitingTimer = null;
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
    let mainMenuMusic = null;
    let gameplayMusic = null;
    let musicEnabled = true;
    let currentMusic = null;
    
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© Ù…Ø¹ Ø§Ù„ØµÙˆØ±
    const CITIES = [
      { name: "Ù…ÙƒØ©", color: "Ø£Ø­Ù…Ø±" },
      { name: "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©", color: "Ø£Ø®Ø¶Ø±" },
      { name: "Ø§Ù„Ø±ÙŠØ§Ø¶", color: "Ø£Ø­Ù…Ø±" },
      { name: "Ø¬Ø¯Ø©", color: "Ø£Ø²Ø±Ù‚" },
      { name: "Ø§Ù„Ø¯Ù…Ø§Ù…", color: "Ø£Ø²Ø±Ù‚" },
      { name: "Ø§Ù„Ø¯Ø±Ø¹ÙŠØ©", color: "Ø£Ø­Ù…Ø±" },
      { name: "Ø£Ø¨Ù‡Ø§", color: "Ø£ØµÙØ±" },
      { name: "Ø§Ù„Ø¹Ù„Ø§", color: "Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ" },
      { name: "Ù†ÙŠÙˆÙ…", color: "Ø¨Ù†ÙØ³Ø¬ÙŠ" }
    ];
    
    const COLORS = [
      { name: "Ø£Ø­Ù…Ø±", value: "#ef4444" },
      { name: "Ø£Ø²Ø±Ù‚", value: "#3b82f6" },
      { name: "Ø£Ø®Ø¶Ø±", value: "#10b981" },
      { name: "Ø£ØµÙØ±", value: "#fbbf24" }
    ];
    
    const SPECIAL_CARDS = [
      { type: "skip", name: "ØªØ®Ø·ÙŠ", imageUrl: "https://i.ibb.co/W4vfTNdH/45.png" },
      { type: "reverse", name: "Ø¹ÙƒØ³", imageUrl: "https://i.ibb.co/Hpqc0grL/44.png" },
      { type: "draw2", name: "+2", imageUrl: "https://i.ibb.co/FLZ8zWZj/43.png" },
      { type: "wildColor", name: "ØªØºÙŠÙŠØ± Ù„ÙˆÙ†", imageUrl: "https://i.ibb.co/wNTGb1C9/41.png" },
      { type: "wildCity", name: "ØªØºÙŠÙŠØ± Ù…Ø¯ÙŠÙ†Ø©", imageUrl: "https://i.ibb.co/6R7kFGQF/42.png" }
    ];
    
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ± Ù„ÙƒÙ„ Ù…Ø¯ÙŠÙ†Ø© ÙˆÙ„ÙˆÙ†
    const CITY_IMAGES = {
      "Ù…ÙƒØ©": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/gMQ47K9t/5.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/twKd4jv1/6.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/BVVMDHvT/7.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/b52j1M9G/8.png"
      },
      "Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/F4WqkgGf/9.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/dJLD6cMY/10.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/vxtyKryp/11.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/Gfc53rxK/12.png"
      },
      "Ø§Ù„Ø±ÙŠØ§Ø¶": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/MkPcdSZW/13.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/LdCvYk0j/14.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/kg7G3Q7k/15.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/W4cNf7vY/16.png"
      },
      "Ø¬Ø¯Ø©": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/BYbts6g/17.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/PR7WQDX/18.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/ymsFX3MM/19.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/zWNLMhbq/20.png"
      },
      "Ø§Ù„Ø¯Ù…Ø§Ù…": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/n8RRCDSz/21.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/rRJpfsmK/22.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/X9CwM7b/23.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/93spT6LB/24.png"
      },
      "Ø§Ù„Ø¯Ø±Ø¹ÙŠØ©": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/67JFVWBF/25.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/wN44SbGk/26.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/FCG9xR1/27.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/3mqDw2sP/28.png"
      },
      "Ø£Ø¨Ù‡Ø§": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/SXNq5P21/29.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/nM043Ycb/30.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/Q78kwgkx/31.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/kkLX3xv/32.png"
      },
      "Ø§Ù„Ø¹Ù„Ø§": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/Qv1MpQKv/37.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/LzFkKVg3/38.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/tMgW3shr/39.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/qL9fWvVS/40.png"
      },
      "Ù†ÙŠÙˆÙ…": {
        "Ø£Ø­Ù…Ø±": "https://i.ibb.co/nMcBNFxW/33.png",
        "Ø£Ø²Ø±Ù‚": "https://i.ibb.co/zW1pFVVF/34.png",
        "Ø£Ø®Ø¶Ø±": "https://i.ibb.co/5hLsG16M/35.png",
        "Ø£ØµÙØ±": "https://i.ibb.co/21bQxPJn/36.png"
      }
    };
    
    const PLAYER_ICONS = ["ğŸ‘¤", "ğŸ¤–", "ğŸ‘¨", "ğŸ‘©", "ğŸ‘¦", "ğŸ‘§", "ğŸ§”", "ğŸ‘±", "ğŸ‘¨â€ğŸ¦±", "ğŸ‘©â€ğŸ¦°", "ğŸ§‘", "ğŸ‘´", "ğŸ‘µ", "ğŸ‘¨â€âš•ï¸", "ğŸ‘©â€âš•ï¸", "ğŸ‘¨â€ğŸ“", "ğŸ‘©â€ğŸ“", "ğŸ¦¸", "ğŸ¦¹", "ğŸ§™"];
    const PLAYER_COLORS = ["#10b981", "#ef4444", "#3b82f6", "#f59e0b"];
    const AI_NAMES = ["Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "Ø§Ù„Ø±ÙˆØ¨ÙˆØª Ø§Ù„Ø°ÙƒÙŠ", "Ø§Ù„Ù…Ù†Ø§ÙØ³ Ø§Ù„Ø¢Ù„ÙŠ", "Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±"];
    
    // ==================== Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ====================
    
    function initAuthSystem() {
        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† localStorage
        const savedUsers = localStorage.getItem('saudiTourUsers');
        if (savedUsers) {
            usersDatabase = JSON.parse(savedUsers);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const savedUser = localStorage.getItem('saudiTourCurrentUser');
        const savedSession = localStorage.getItem('saudiTourSession');
        
        if (savedUser && savedSession) {
            try {
                const sessionData = JSON.parse(savedSession);
                const userData = JSON.parse(savedUser);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©
                if (sessionData.expires > Date.now()) {
                    currentUser = userData;
                    updateUserStatusBar();
                } else {
                    // Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ù†ØªÙ‡ÙŠØ©
                    localStorage.removeItem('saudiTourCurrentUser');
                    localStorage.removeItem('saudiTourSession');
                    showLoginScreen();
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
                showLoginScreen();
            }
        } else {
            showLoginScreen();
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù‡Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø©
        setupSessionTimeout();
    }
    
    function setupSessionTimeout() {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„
        document.addEventListener('click', resetSessionTimeout);
        document.addEventListener('keypress', resetSessionTimeout);
        document.addEventListener('mousemove', resetSessionTimeout);
    }
    
    function resetSessionTimeout() {
        if (sessionTimeout) {
            clearTimeout(sessionTimeout);
        }
        
        // ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© (30 Ø¯Ù‚ÙŠÙ‚Ø©)
        sessionTimeout = setTimeout(() => {
            if (currentUser) {
                showNotification('â° ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·');
                logoutUser();
            }
        }, 30 * 60 * 1000);
    }
    
    function updateUserStatusBar() {
        const userStatusBar = document.getElementById('userStatusBar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userPoints = document.getElementById('userPoints');
        const userAvatar = document.getElementById('userAvatar');
        
        if (currentUser) {
            userStatusBar.classList.remove('hidden');
            userName.textContent = currentUser.name;
            userEmail.textContent = currentUser.email;
            userPoints.textContent = `${currentUser.points} Ù†Ù‚Ø·Ø©`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©
            if (currentUser.avatar) {
                userAvatar.innerHTML = currentUser.avatar;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            document.getElementById('menuUserName').textContent = currentUser.name;
            document.getElementById('menuUserEmail').textContent = currentUser.email;
        } else {
            userStatusBar.classList.add('hidden');
            userName.textContent = 'Ø§Ù„Ø¶ÙŠÙ';
            userEmail.textContent = 'ØºÙŠØ± Ù…Ø³Ø¬Ù„';
            userPoints.textContent = '0 Ù†Ù‚Ø·Ø©';
            userAvatar.innerHTML = 'ğŸ‘¤';
        }
    }
    
    function toggleUserMenu() {
        const userMenu = document.getElementById('userMenu');
        userMenu.classList.toggle('hidden');
    }
    
    function showLoginScreen() {
        hideAllScreens();
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('loginEmail').focus();
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('userStatusBar').classList.add('hidden');
        document.getElementById('userMenu').classList.add('hidden');
    }
    
    function showRegisterScreen() {
        hideAllScreens();
        document.getElementById('registerScreen').classList.remove('hidden');
        document.getElementById('registerName').focus();
    }
    
    function showForgotPassword() {
        hideAllScreens();
        document.getElementById('forgotPasswordScreen').classList.remove('hidden');
        document.getElementById('forgotEmail').focus();
    }
    
    function showResetPasswordScreen() {
        hideAllScreens();
        document.getElementById('resetPasswordScreen').classList.remove('hidden');
        document.getElementById('resetNewPassword').focus();
    }
    
    function showTermsModal() {
        document.getElementById('termsModal').classList.remove('hidden');
    }
    
    function closeTermsModal() {
        document.getElementById('termsModal').classList.add('hidden');
    }
    
    function showPrivacyModal() {
        document.getElementById('privacyModal').classList.remove('hidden');
    }
    
    function closePrivacyModal() {
        document.getElementById('privacyModal').classList.add('hidden');
    }
    
    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
    
    function validatePassword(password) {
        const requirements = {
            length: password.length >= 8,
            number: /\d/.test(password),
            upper: /[A-Z]/.test(password),
            special: /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)
        };
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙˆØ©
        let strength = 0;
        if (requirements.length) strength += 25;
        if (requirements.number) strength += 25;
        if (requirements.upper) strength += 25;
        if (requirements.special) strength += 25;
        
        return {
            isValid: requirements.length && requirements.number && requirements.upper && requirements.special,
            strength: strength,
            requirements: requirements
        };
    }
    
    function checkPasswordStrength(password) {
        const validation = validatePassword(password);
        const strengthBar = document.getElementById('passwordStrengthBar');
        const strengthText = document.getElementById('passwordStrengthText');
        const requirements = ['lengthReq', 'numberReq', 'upperReq', 'specialReq'];
        
        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ù‚ÙˆØ©
        strengthBar.style.width = validation.strength + '%';
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù„ÙˆÙ†
        let color = '#ef4444';
        let text = 'Ø¶Ø¹ÙŠÙØ©';
        
        if (validation.strength >= 75) {
            color = '#10b981';
            text = 'Ù‚ÙˆÙŠØ© Ø¬Ø¯Ø§Ù‹';
        } else if (validation.strength >= 50) {
            color = '#fbbf24';
            text = 'Ù‚ÙˆÙŠØ©';
        } else if (validation.strength >= 25) {
            color = '#f59e0b';
            text = 'Ù…ØªÙˆØ³Ø·Ø©';
        }
        
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = text;
        strengthText.style.color = color;
        
        // ØªØ­Ø¯ÙŠØ« Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚ÙˆØ©
        requirements.forEach((req, index) => {
            const element = document.getElementById(req);
            const reqMet = Object.values(validation.requirements)[index];
            element.style.color = reqMet ? '#10b981' : '#ef4444';
            if (reqMet) {
                element.innerHTML = element.innerHTML.replace('â€¢', 'âœ“');
            } else {
                element.innerHTML = element.innerHTML.replace('âœ“', 'â€¢');
            }
        });
    }
    
    function checkResetPasswordStrength(password) {
        const validation = validatePassword(password);
        const strengthBar = document.getElementById('resetPasswordStrengthBar');
        
        strengthBar.style.width = validation.strength + '%';
        
        let color = '#ef4444';
        if (validation.strength >= 75) color = '#10b981';
        else if (validation.strength >= 50) color = '#fbbf24';
        else if (validation.strength >= 25) color = '#f59e0b';
        
        strengthBar.style.backgroundColor = color;
    }
    
    function togglePasswordVisibility(inputId) {
        const input = document.getElementById(inputId);
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);
    }
    
    function loginUser() {
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        const rememberMe = document.getElementById('rememberMe').checked;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        document.getElementById('loginEmailError').classList.add('hidden');
        document.getElementById('loginPasswordError').classList.add('hidden');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        if (!email) {
            showError('loginEmailError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            return;
        }
        
        if (!validateEmail(email)) {
            showError('loginEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        if (!password) {
            showError('loginPasswordError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±');
            return;
        }
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…
        showNotification('ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...');
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const user = usersDatabase[email];
        
        if (!user) {
            showError('loginEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ÙŠØ¬Ø¨ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù‡Ø§Ø´)
        const hashedPassword = simpleHash(password);
        if (user.password !== hashedPassword) {
            showError('loginPasswordError', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
        if (user.status === 'suspended') {
            showError('loginEmailError', 'Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚ÙˆÙ Ù…Ø¤Ù‚ØªØ§Ù‹');
            return;
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­
        currentUser = {
            id: user.id,
            email: user.email,
            name: user.name,
            avatar: user.avatar,
            points: user.points || 0,
            level: user.level || 1,
            joinDate: user.joinDate
        };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø©
        const sessionData = {
            userId: user.id,
            token: generateToken(),
            expires: rememberMe ? Date.now() + (30 * 24 * 60 * 60 * 1000) : Date.now() + (2 * 60 * 60 * 1000)
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
        localStorage.setItem('saudiTourCurrentUser', JSON.stringify(currentUser));
        localStorage.setItem('saudiTourSession', JSON.stringify(sessionData));
        
        // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ø¯Ø®ÙˆÙ„
        user.lastLogin = new Date().toISOString();
        saveUsersDatabase();
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        showNotification(`âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.name}`);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        hideAllScreens();
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUserStatusBar();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        setTimeout(() => {
            showStartScreen();
        }, 1000);
    }
    
    function registerUser() {
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim();
        const password = document.getElementById('registerPassword').value;
        const confirmPassword = document.getElementById('registerConfirmPassword').value;
        const acceptTerms = document.getElementById('acceptTerms').checked;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        ['registerNameError', 'registerEmailError', 'registerPasswordError', 'registerConfirmPasswordError']
            .forEach(id => document.getElementById(id).classList.add('hidden'));
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
        if (!name || name.length < 2) {
            showError('registerNameError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­ (Ø­Ø±ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        if (!email) {
            showError('registerEmailError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            return;
        }
        
        if (!validateEmail(email)) {
            showError('registerEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        const passwordValidation = validatePassword(password);
        if (!passwordValidation.isValid) {
            showError('registerPasswordError', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§ ØªÙ„Ø¨ÙŠ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        if (password !== confirmPassword) {
            showError('registerConfirmPasswordError', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø´Ø±ÙˆØ·
        if (!acceptTerms) {
            showNotification('âš ï¸ ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹
        if (usersDatabase[email]) {
            showError('registerEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹');
            return;
        }
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…
        showNotification('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ...');
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
        const userId = generateUserId();
        const hashedPassword = simpleHash(password);
        
        const newUser = {
            id: userId,
            name: name,
            email: email,
            password: hashedPassword,
            avatar: generateAvatar(name),
            points: 100,
            level: 1,
            status: 'active',
            joinDate: new Date().toISOString(),
            lastLogin: new Date().toISOString(),
            achievements: [],
            gameStats: {
                gamesPlayed: 0,
                gamesWon: 0,
                totalPoints: 100,
                winStreak: 0,
                bestStreak: 0
            }
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        usersDatabase[email] = newUser;
        saveUsersDatabase();
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        currentUser = {
            id: newUser.id,
            email: newUser.email,
            name: newUser.name,
            avatar: newUser.avatar,
            points: newUser.points,
            level: newUser.level,
            joinDate: newUser.joinDate
        };
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø©
        const sessionData = {
            userId: newUser.id,
            token: generateToken(),
            expires: Date.now() + (2 * 60 * 60 * 1000)
        };
        
        // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
        localStorage.setItem('saudiTourCurrentUser', JSON.stringify(currentUser));
        localStorage.setItem('saudiTourSession', JSON.stringify(sessionData));
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
        showNotification(`ğŸ‰ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 100 Ù†Ù‚Ø·Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©`);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
        hideAllScreens();
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        updateUserStatusBar();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        setTimeout(() => {
            showStartScreen();
        }, 1500);
    }
    
    function sendResetLink() {
        const email = document.getElementById('forgotEmail').value.trim();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ø·Ø£
        document.getElementById('forgotEmailError').classList.add('hidden');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        if (!email) {
            showError('forgotEmailError', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            return;
        }
        
        if (!validateEmail(email)) {
            showError('forgotEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (!usersDatabase[email]) {
            showError('forgotEmailError', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„');
            return;
        }
        
        // Ù…Ø­Ø§ÙƒØ§Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        showNotification('ğŸ“§ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†...');
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
        const resetToken = generateResetToken();
        const expires = Date.now() + (24 * 60 * 60 * 1000);
        
        // Ø­ÙØ¸ Ø§Ù„Ø±Ù…Ø²
        resetTokens[resetToken] = {
            email: email,
            expires: expires
        };
        
        localStorage.setItem('saudiTourResetTokens', JSON.stringify(resetTokens));
        
        setTimeout(() => {
            showNotification(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ø¥Ù„Ù‰ ${email}`);
            
            console.log(`Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù„Ù„ØªØ¬Ø±Ø¨Ø©): reset-password.html?token=${resetToken}`);
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="text-5xl mb-6">ğŸ“¬</div>
                    <h2 class="text-2xl font-bold mb-5">Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)</h2>
                    <div class="bg-gray-100 p-4 rounded-xl mb-6">
                        <p class="text-sm text-gray-600 mb-2">ÙÙŠ Ø¨ÙŠØ¦Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ Ø³ÙŠØµÙ„Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ:</p>
                        <p class="font-mono text-blue-600 break-all">https://example.com/reset-password?token=${resetToken}</p>
                    </div>
                    <p class="text-gray-600 mb-6">Ù„Ù„ØªØ¬Ø±Ø¨Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø² ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ Ø´Ø§Ø´Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</p>
                    <div class="flex gap-4">
                        <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 font-bold py-3 rounded-xl">
                            Ø¥Ù„ØºØ§Ø¡
                        </button>
                        <button onclick="useResetToken('${resetToken}')" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 rounded-xl">
                            Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ù…Ø²
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }, 2000);
    }
    
    function useResetToken(token) {
        closeModal();
        showResetPasswordScreen();
        showNotification(`ğŸ”‘ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©`);
    }
    
    function resetPassword() {
        const newPassword = document.getElementById('resetNewPassword').value;
        const confirmPassword = document.getElementById('resetConfirmPassword').value;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        document.getElementById('resetNewPasswordError').classList.add('hidden');
        document.getElementById('resetConfirmPasswordError').classList.add('hidden');
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        const passwordValidation = validatePassword(newPassword);
        if (!passwordValidation.isValid) {
            showError('resetNewPasswordError', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§ ØªÙ„Ø¨ÙŠ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª');
            return;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        if (newPassword !== confirmPassword) {
            showError('resetConfirmPasswordError', 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©');
            return;
        }
        
        showNotification('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±...');
        
        setTimeout(() => {
            showNotification('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
            
            setTimeout(() => {
                showLoginScreen();
            }, 1500);
        }, 2000);
    }
    
    function continueAsGuest() {
        showNotification('ğŸ‘‹ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙƒØ¶ÙŠÙ! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù„Ø­ÙØ¸ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ');
        hideAllScreens();
        currentUser = null;
        updateUserStatusBar();
        setTimeout(() => {
            showStartScreen();
        }, 500);
    }
    
    function loginWithGoogle() {
        showNotification('ğŸ”— Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø­Ø³Ø§Ø¨ Google...');
        setTimeout(() => {
            showNotification('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹');
        }, 1500);
    }
    
    function loginWithApple() {
        showNotification('ğŸ”— Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø­Ø³Ø§Ø¨ Apple...');
        setTimeout(() => {
            showNotification('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ± Ø­Ø§Ù„ÙŠØ§Ù‹');
        }, 1500);
    }
    
    function logoutUser() {
        const confirmLogout = confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ');
        
        if (confirmLogout) {
            localStorage.removeItem('saudiTourCurrentUser');
            localStorage.removeItem('saudiTourSession');
            
            currentUser = null;
            
            updateUserStatusBar();
            document.getElementById('userMenu').classList.add('hidden');
            
            showNotification('ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­');
            
            setTimeout(() => {
                showLoginScreen();
            }, 1000);
        }
    }
    
    function showError(elementId, message) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.classList.remove('hidden');
        
        const inputElement = document.getElementById(elementId.replace('Error', ''));
        if (inputElement) {
            inputElement.classList.add('shake-effect');
            setTimeout(() => {
                inputElement.classList.remove('shake-effect');
            }, 500);
        }
    }
    
    function generateToken() {
        return Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2);
    }
    
    function generateUserId() {
        return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }
    
    function generateResetToken() {
        return 'reset_' + Date.now() + '_' + Math.random().toString(36).substr(2, 12);
    }
    
    function simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return hash.toString(36);
    }
    
    function generateAvatar(name) {
        const colors = ['#667eea', '#764ba2', '#f56565', '#ed8936', '#ecc94b', '#48bb78', '#38b2ac'];
        const color = colors[name.length % colors.length];
        
        const initials = name.split(' ').map(word => word[0]).join('').toUpperCase().substr(0, 2);
        
        return `
            <div style="width: 100%; height: 100%; background: ${color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 20px;">
                ${initials}
            </div>
        `;
    }
    
    function saveUsersDatabase() {
        localStorage.setItem('saudiTourUsers', JSON.stringify(usersDatabase));
    }
    
    function showProfile() {
        if (!currentUser) {
            showLoginScreen();
            return;
        }
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 500px;">
                <div class="text-center mb-6">
                    <div class="w-24 h-24 rounded-full mx-auto mb-4 overflow-hidden" id="profileAvatar">
                        ${currentUser.avatar || 'ğŸ‘¤'}
                    </div>
                    <h2 class="text-2xl font-bold">${currentUser.name}</h2>
                    <p class="text-gray-600">${currentUser.email}</p>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-gray-50 rounded-xl p-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-700">Ø§Ù„Ù…Ø³ØªÙˆÙ‰:</span>
                            <span class="font-bold text-blue-600">${currentUser.level || 1}</span>
                        </div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-700">Ø§Ù„Ù†Ù‚Ø§Ø·:</span>
                            <span class="font-bold text-green-600">${currentUser.points || 0}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</span>
                            <span class="text-gray-600">${new Date(currentUser.joinDate).toLocaleDateString('ar-SA')}</span>
                        </div>
                    </div>
                    
                    <button onclick="editProfile()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 rounded-xl">
                        âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
                    </button>
                    
                    <button onclick="closeModal()" class="w-full bg-gray-300 text-gray-700 font-bold py-3 rounded-xl">
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        document.getElementById('userMenu').classList.add('hidden');
    }
    
    function editProfile() {
      if (!currentUser) {
        showNotification('âš ï¸ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
        return;
      }
  
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <h2 class="text-2xl font-bold mb-6 text-center">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
      
          <div class="space-y-4">
            <!-- Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ© -->
            <div class="text-center mb-6">
              <div id="editAvatarPreview" class="w-24 h-24 rounded-full mx-auto mb-4 overflow-hidden cursor-pointer" 
                   onclick="openAvatarPicker()" 
                   style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                ${currentUser.avatar || 'ğŸ‘¤'}
              </div>
              <p class="text-sm text-gray-600">Ø§Ù†Ù‚Ø± Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©</p>
            </div>
        
            <!-- Ø§Ù„Ø§Ø³Ù… -->
            <div class="text-right">
              <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
              <input type="text" id="editProfileName" 
                     class="w-full p-4 border-2 border-gray-300 rounded-xl text-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                     value="${currentUser.name}"
                     placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
        
            <!-- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„) -->
            <div class="text-right">
              <label class="block text-gray-700 font-bold mb-2 text-lg">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input type="email" id="editProfileEmail" 
                     class="w-full p-4 border-2 border-gray-300 rounded-xl text-lg bg-gray-100"
                     value="${currentUser.email}"
                     disabled>
              <p class="text-sm text-gray-500 mt-1">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØºÙŠÙŠØ±</p>
            </div>
        
            <div class="flex gap-4 mt-6">
              <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 font-bold py-3 rounded-xl">
                Ø¥Ù„ØºØ§Ø¡
              </button>
              <button onclick="saveProfileChanges()" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-3 rounded-xl">
                Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ğŸ’¾
              </button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      document.getElementById('userMenu').classList.add('hidden');
    }

    function openAvatarPicker() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <h2 class="text-2xl font-bold mb-5 text-center">ğŸ˜Š Ø§Ø®ØªØ± ØµÙˆØ±ØªÙƒ Ø§Ù„Ø±Ù…Ø²ÙŠØ©</h2>
      
          <div class="grid grid-cols-6 gap-3 mb-6">
            ${PLAYER_ICONS.map(icon => `
              <div class="icon-option ${currentUser.avatar && currentUser.avatar.includes(icon) ? 'selected' : ''}" 
                   onclick="selectAvatarIcon('${icon}')">
                ${icon}
              </div>
            `).join('')}
          </div>
      
          <div class="mt-4">
            <p class="text-gray-600 mb-3 text-center">Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©</p>
            <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="uploadCustomAvatar(event)">
            <button onclick="document.getElementById('avatarUpload').click()" 
                    class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 rounded-xl mb-4">
              ğŸ“· Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²
            </button>
          </div>
      
          <button onclick="closeModal()" class="w-full bg-gray-300 text-gray-700 font-bold py-3 rounded-xl">
            Ø¥ØºÙ„Ø§Ù‚
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function selectAvatarIcon(icon) {
      currentUser.avatar = icon;
  
      const preview = document.getElementById('editAvatarPreview');
      if (preview) {
        preview.innerHTML = icon;
      }
  
      showNotification('âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ù…Ø²ÙŠØ©');
      closeModal();
    }

    function uploadCustomAvatar(event) {
      const file = event.target.files[0];
      if (!file) return;
  
      if (!file.type.startsWith('image/')) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙÙ‚Ø·');
        return;
      }
  
      const reader = new FileReader();
      reader.onload = function(e) {
         currentUser.avatar = `
          <div style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden;">
            <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
          </div> 
        `;
    
        const preview = document.getElementById('editAvatarPreview');
        if (preview) {
          preview.innerHTML = currentUser.avatar;
        }
    
        showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­');
        closeModal();
      };
  
      reader.readAsDataURL(file);
    }

    function saveProfileChanges() {
      const newName = document.getElementById('editProfileName').value.trim();
  
      if (!newName) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­');
        return;
      }
  
      currentUser.name = newName;
  
      if (usersDatabase[currentUser.email]) {
        usersDatabase[currentUser.email].name = newName;
        usersDatabase[currentUser.email].avatar = currentUser.avatar;
        saveUsersDatabase();
      }
  
      localStorage.setItem('saudiTourCurrentUser', JSON.stringify(currentUser));
  
      updateUserStatusBar();
  
      showNotification('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
      closeModal();
    }
    
    function showStats() {
        if (!currentUser) {
            showLoginScreen();
            return;
        }
        
        const userEmail = currentUser.email;
        const userData = usersDatabase[userEmail];
        const stats = userData ? userData.gameStats : {
            gamesPlayed: 0,
            gamesWon: 0,
            totalPoints: currentUser.points || 0,
            winStreak: 0,
            bestStreak: 0
        };
        
        const winRate = stats.gamesPlayed > 0 ? ((stats.gamesWon / stats.gamesPlayed) * 100).toFixed(1) : 0;
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
            <div class="modal-content" style="max-width: 550px;">
                <h2 class="text-2xl font-bold mb-6 text-center">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù„Ø¹Ø¨</h2>
                
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 text-center">
                        <div class="text-4xl mb-2">ğŸ®</div>
                        <p class="text-gray-600 text-sm">Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù…Ù„Ø¹ÙˆØ¨Ø©</p>
                        <p class="text-3xl font-bold text-blue-600">${stats.gamesPlayed}</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-5 text-center">
                        <div class="text-4xl mb-2">ğŸ†</div>
                        <p class="text-gray-600 text-sm">Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„ÙØ§Ø¦Ø²Ø©</p>
                        <p class="text-3xl font-bold text-green-600">${stats.gamesWon}</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-5 text-center">
                        <div class="text-4xl mb-2">ğŸ“ˆ</div>
                        <p class="text-gray-600 text-sm">Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ²</p>
                        <p class="text-3xl font-bold text-yellow-600">${winRate}%</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-5 text-center">
                        <div class="text-4xl mb-2">ğŸ’</div>
                        <p class="text-gray-600 text-sm">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</p>
                        <p class="text-3xl font-bold text-purple-600">${stats.totalPoints}</p>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl p-5 mb-6">
                    <h3 class="font-bold text-lg mb-4">ğŸ”¥ Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø§Ù†ØªØµØ§Ø±Ø§Øª</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Ø§Ù„Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                            <span class="font-bold ${stats.winStreak > 0 ? 'text-green-600' : 'text-gray-600'}">
                                ${stats.winStreak} Ø§Ù†ØªØµØ§Ø±Ø§Øª
                            </span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©:</span>
                            <span class="font-bold text-yellow-600">${stats.bestStreak} Ø§Ù†ØªØµØ§Ø±Ø§Øª</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 rounded-xl">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        `;
        document.body.appendChild(modal);
        document.getElementById('userMenu').classList.add('hidden');
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ====================
    
    function initMusicSystem() {
        mainMenuMusic = document.getElementById('mainMenuMusic');
        gameplayMusic = document.getElementById('gameplayMusic');
        
        if (mainMenuMusic) mainMenuMusic.volume = 0.3;
        if (gameplayMusic) gameplayMusic.volume = 0.2;
        
        if (mainMenuMusic) mainMenuMusic.load();
        if (gameplayMusic) gameplayMusic.load();
        
        const savedMusicSetting = localStorage.getItem('saudiTourMusicEnabled');
        if (savedMusicSetting !== null) {
            musicEnabled = savedMusicSetting === 'true';
        }
        
        updateMusicButtons();
    }
    
    function playMainMenuMusic() {
        if (!musicEnabled || !mainMenuMusic || isLowPerfDevice) return;
        
        try {
            stopAllMusic();
            
            mainMenuMusic.currentTime = 0;
            mainMenuMusic.play().then(() => {
                currentMusic = 'mainMenu';
            }).catch(error => {
                console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:', error);
            });
        } catch (error) {
            console.log('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:', error);
        }
    }
    
    function playGameplayMusic() {
        if (!musicEnabled || !gameplayMusic || isLowPerfDevice) return;
        
        try {
            if (mainMenuMusic && !mainMenuMusic.paused) {
                mainMenuMusic.pause();
                mainMenuMusic.currentTime = 0;
            }
            
            gameplayMusic.currentTime = 0;
            gameplayMusic.play().then(() => {
                currentMusic = 'gameplay';
            }).catch(error => {
                console.log('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù„Ø¹Ø¨:', error);
            });
        } catch (error) {
            console.log('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ø§Ù„Ù„Ø¹Ø¨:', error);
        }
    }
    
    function stopAllMusic() {
        if (mainMenuMusic && !mainMenuMusic.paused) {
            mainMenuMusic.pause();
            mainMenuMusic.currentTime = 0;
        }
        
        if (gameplayMusic && !gameplayMusic.paused) {
            gameplayMusic.pause();
            gameplayMusic.currentTime = 0;
        }
        
        currentMusic = null;
    }
    
    function toggleMusic() {
        musicEnabled = !musicEnabled;
        
        updateMusicButtons();
        
        if (musicEnabled) {
            showNotification('ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰');
            
            if (document.getElementById('startScreen') && 
                !document.getElementById('startScreen').classList.contains('hidden')) {
                playMainMenuMusic();
            }
            else if (document.getElementById('gameScreen') && 
                !document.getElementById('gameScreen').classList.contains('hidden')) {
                playGameplayMusic();
            }
        } else {
            showNotification('ğŸ”‡ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰');
            stopAllMusic();
        }
        
        localStorage.setItem('saudiTourMusicEnabled', musicEnabled);
    }
    
    function updateMusicButtons() {
        const musicToggleMain = document.getElementById('musicToggleMain');
        const musicToggleGame = document.getElementById('musicToggleGame');
        
        if (musicEnabled) {
            if (musicToggleMain) {
                musicToggleMain.innerHTML = 'ğŸ”Š';
                musicToggleMain.classList.remove('muted');
                musicToggleMain.title = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
            }
            if (musicToggleGame) {
                musicToggleGame.innerHTML = 'ğŸ”Š';
                musicToggleGame.classList.remove('muted');
                musicToggleGame.title = 'Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
            }
        } else {
            if (musicToggleMain) {
                musicToggleMain.innerHTML = 'ğŸ”‡';
                musicToggleMain.classList.add('muted');
                musicToggleMain.title = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
            }
            if (musicToggleGame) {
                musicToggleGame.innerHTML = 'ğŸ”‡';
                musicToggleGame.classList.add('muted');
                musicToggleGame.title = 'ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰';
            }
        }
    }
    
    function updateMusicButtonVisibility() {
        const musicToggleMain = document.getElementById('musicToggleMain');
        const musicToggleGame = document.getElementById('musicToggleGame');
        
        if (document.getElementById('startScreen') && 
            !document.getElementById('startScreen').classList.contains('hidden')) {
            if (musicToggleMain) musicToggleMain.classList.remove('hidden');
            if (musicToggleGame) musicToggleGame.classList.add('hidden');
        }
        else if (document.getElementById('gameScreen') && 
            !document.getElementById('gameScreen').classList.contains('hidden')) {
            if (musicToggleMain) musicToggleMain.classList.add('hidden');
            if (musicToggleGame) musicToggleGame.classList.remove('hidden');
        }
        else {
            if (musicToggleMain) musicToggleMain.classList.add('hidden');
            if (musicToggleGame) musicToggleGame.classList.add('hidden');
        }
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙˆØ§Ù„ØµÙˆØ± ====================

    function openIconPicker(playerIndex) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">Ø§Ø®ØªØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerIndex + 1}</h2>
          
          <div class="mb-5">
            <label class="block text-gray-700 font-bold mb-3">Ø£Ùˆ Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ:</label>
            <input type="file" id="imageUpload-${playerIndex}" accept="image/*" style="display: none;" onchange="handleImageUpload(${playerIndex}, event)">
            <div class="flex justify-center">
              <div class="upload-icon-btn" onclick="document.getElementById('imageUpload-${playerIndex}').click()">
                ğŸ“·
              </div>
            </div>
            <p class="text-sm text-gray-500 text-center mt-3">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ</p>
            <p class="text-xs text-gray-400 text-center mt-2">(ÙŠØ´ØªØ±Ø· Ø§Ù„ÙÙˆØ² Ø¨Ù€ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ© Ø£Ùˆ Ø®ØµÙ… 500 Ù†Ù‚Ø·Ø©)</p>
          </div>
          
          <div class="border-t pt-5">
            <p class="text-gray-700 font-bold mb-4">Ø£Ùˆ Ø§Ø®ØªØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¬Ø§Ù‡Ø²Ø©:</p>
            <div class="grid grid-cols-5 gap-4 mb-8">
              ${PLAYER_ICONS.map((icon, index) => `
                <div class="icon-option ${selectedPlayerIcons[playerIndex] === icon && !customPlayerImages[playerIndex] ? 'selected' : ''}" 
                     onclick="selectIcon(${playerIndex}, '${icon}', event)">
                  ${icon}
                </div>
              `).join('')}
            </div>
          </div>
          
          <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            ØªÙ…
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function selectIcon(playerIndex, icon, event) {
      selectedPlayerIcons[playerIndex] = icon;
      customPlayerImages[playerIndex] = null;
      
      const iconElement = document.getElementById(`player-icon-${playerIndex}`);
      if (iconElement) {
        iconElement.innerHTML = icon;
        iconElement.classList.add('bounce-effect');
        setTimeout(() => iconElement.classList.remove('bounce-effect'), 600);
      }
      
      if (event && event.target) {
        document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
        event.target.classList.add('selected');
      }
      
      showNotification(`âœ… ØªÙ… ØªØºÙŠÙŠØ± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerIndex + 1} Ø¥Ù„Ù‰ ${icon}`);
      closeModal();
    }

    function handleImageUpload(playerIndex, event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!file.type.startsWith('image/')) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ÙÙ‚Ø·');
        return;
      }
      
      if (file.size > 5 * 1024 * 1024) {
        showNotification('âš ï¸ Ø­Ø¬Ù… Ø§Ù„ØµÙˆØ±Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ (Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 5MB)');
        return;
      }
      
      const playerName = document.getElementById(`player-name-${playerIndex}`).value || `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${playerIndex + 1}`;
      const playerStats = getPlayerStats(playerName);
      
      const hasWinStreak5 = playerStats.win_streak >= 5 || playerStats.best_streak >= 5;
      const hasEnoughPoints = playerStats.total_points >= 500;
      
      if (!hasWinStreak5 && !hasEnoughPoints) {
        showUnlockRequirementModal();
        event.target.value = '';
        return;
      }
      
      if (!hasWinStreak5 && hasEnoughPoints) {
        showPointDeductionModal(playerIndex, file, playerStats);
        return;
      }
      
      processImageUpload(playerIndex, file);
    }

    function getPlayerStats(playerName) {
      return {
        player_name: playerName,
        wins: 0,
        losses: 0,
        total_points: 0,
        games_played: 0,
        win_streak: 0,
        best_streak: 0,
        achievements: "[]"
      };
    }

    function showUnlockRequirementModal() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <div class="text-6xl mb-5">ğŸ”’</div>
          <h2 class="text-2xl font-bold mb-5" style="color: #ef4444;">Ù…ÙŠØ²Ø© Ù…Ù‚ÙÙ„Ø©!</h2>
          <p class="text-gray-700 mb-5 text-lg">Ù„Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©ØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ:</p>
          
          <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-5 mb-4 border-3 border-yellow-300">
            <div class="flex items-center gap-4">
              <span class="text-4xl">ğŸ”¥</span>
              <div class="text-right flex-1">
                <p class="font-bold text-xl">Ø§Ù„ÙÙˆØ² Ø¨Ù€ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©</p>
                <p class="text-base text-gray-600">Ø£Ùˆ</p>
              </div>
            </div>
          </div>
          
          <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-5 mb-8 border-3 border-blue-300">
            <div class="flex items-center gap-4">
              <span class="text-4xl">ğŸ’</span>
              <div class="text-right flex-1">
                <p class="font-bold text-xl">Ø§Ù…ØªÙ„Ø§Ùƒ 500 Ù†Ù‚Ø·Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</p>
                <p class="text-base text-gray-600">(Ø³ÙŠØªÙ… Ø®ØµÙ… 500 Ù†Ù‚Ø·Ø©)</p>
              </div>
            </div>
          </div>
          
          <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            Ø­Ø³Ù†Ø§Ù‹ØŒ Ø³Ø£Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø°Ù„Ùƒ! ğŸ’ª
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function showPointDeductionModal(playerIndex, file, playerStats) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <div class="text-6xl mb-5">ğŸ’°</div>
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ØªØ£ÙƒÙŠØ¯ Ø®ØµÙ… Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
          
          <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl p-5 mb-5 border-3 border-blue-200">
            <div class="flex items-center justify-between mb-3">
              <span class="text-gray-700 font-bold text-lg">Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
              <span class="text-3xl font-bold text-blue-600">${playerStats.total_points}</span>
            </div>
            <div class="flex items-center justify-between mb-3">
              <span class="text-gray-700 font-bold text-lg">Ø³ÙŠØªÙ… Ø§Ù„Ø®ØµÙ…:</span>
              <span class="text-3xl font-bold text-red-600">-500</span>
            </div>
            <div class="border-t-3 border-blue-200 pt-3 mt-3">
              <div class="flex items-center justify-between">
                <span class="text-gray-700 font-bold text-lg">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:</span>
                <span class="text-3xl font-bold text-green-600">${playerStats.total_points - 500}</span>
              </div>
            </div>
          </div>
          
          <p class="text-gray-600 mb-8 text-center text-lg">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø®ØµÙ… 500 Ù†Ù‚Ø·Ø© Ù„Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø§Ù„Ø®Ø§ØµØ©ØŸ</p>
          
          <div class="flex gap-4">
            <button onclick="closeModal()" class="flex-1 bg-gray-300 text-gray-700 font-bold py-4 px-8 rounded-2xl text-lg">
              Ø¥Ù„ØºØ§Ø¡
            </button>
            <button onclick="confirmPointDeduction(${playerIndex})" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
              ØªØ£ÙƒÙŠØ¯ âœ…
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      tempUploadFile = file;
    }

    function confirmPointDeduction(playerIndex) {
      if (!tempUploadFile) {
        closeModal();
        return;
      }
      
      showNotification('âœ… ØªÙ… Ø®ØµÙ… 500 Ù†Ù‚Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­!');
      processImageUpload(playerIndex, tempUploadFile);
      tempUploadFile = null;
      closeModal();
    }

    function processImageUpload(playerIndex, file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        customPlayerImages[playerIndex] = e.target.result;
        selectedPlayerIcons[playerIndex] = 'ğŸ“·';
        
        const iconElement = document.getElementById(`player-icon-${playerIndex}`);
        if (iconElement) {
          iconElement.innerHTML = `<img src="${e.target.result}" class="custom-image-icon" alt="ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨" />`;
          iconElement.classList.add('bounce-effect');
          setTimeout(() => iconElement.classList.remove('bounce-effect'), 600);
        }
        
        showNotification('âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        closeModal();
      };
      
      reader.onerror = function() {
        showNotification('âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
      };
      
      reader.readAsDataURL(file);
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¨Ø³Ø· ====================
    
    function connectToServer() {
      try {
        showNotification('ğŸŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ...');
        updateConnectionStatus('connecting');
        
        if (!socket || !socket.connected) {
          socket = io(SERVER_URL, {
            transports: ['websocket', 'polling'],
            timeout: 10000,
            reconnection: true,
            reconnectionAttempts: 5,
            reconnectionDelay: 1000
          });
          
          setupSocketListeners();
        }
        
        return socket;
        
      } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…:', error);
        showNotification('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹');
        updateConnectionStatus('disconnected');
        return null;
      }
    }

    function setupSocketListeners() {
      if (!socket) return;
      
      socket.on('connect', () => {
        console.log('âœ… Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
        showNotification('âœ… Ù…ØªØµÙ„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ');
        updateConnectionStatus('connected');
      });
      
      socket.on('game-found', (data) => {
        showNotification(`ğŸ® ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.players.length} Ù„Ø§Ø¹Ø¨ÙŠÙ†ØŒ Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©...`);
        startOnlineGame(data);
      });
      
      socket.on('player-joined', (data) => {
        showNotification(`ğŸ‘¤ ${data.playerName} Ø§Ù†Ø¶Ù… Ù„Ù„Ø¹Ø¨Ø©`);
      });
      
      socket.on('player-left', (data) => {
        showNotification(`ğŸ‘‹ ${data.playerName} ØºØ§Ø¯Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©`);
      });
      
      socket.on('game-started', (data) => {
        onlineGameState = data;
        startOnlineGame(data);
      });
      
      socket.on('game-update', (data) => {
        updateOnlineGame(data);
      });
      
      socket.on('error', (message) => {
        showNotification(`âŒ ${message}`);
      });
      
      socket.on('disconnect', (reason) => {
        console.log('âŒ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„:', reason);
        showNotification('ğŸ“¡ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ±Ø¯ÙŠ');
        gameMode = 'ai';
        selectGameMode('ai');
        updateConnectionStatus('disconnected');
        
        const waitingScreen = document.getElementById('waitingScreen');
        if (waitingScreen) {
          cancelGameSearch();
        }
      });
    }

    function searchForOnlineGame() {
      if (!socket || !socket.connected) {
        showNotification('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹...');
        connectToServer();
        setTimeout(() => {
          if (socket && socket.connected) {
            searchForOnlineGame();
          } else {
            showNotification('âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹');
          }
        }, 2000);
        return;
      }
      
      const playerName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ:', currentUser?.name || 'Ø§Ù„Ù„Ø§Ø¹Ø¨') || 'Ø§Ù„Ù„Ø§Ø¹Ø¨';
      
      if (!playerName.trim()) {
        showNotification('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ØµØ­ÙŠØ­');
        return;
      }
      
      isSearchingForGame = true;
      
      socket.emit('find-game', {
        playerName: playerName.trim(),
        icon: 'ğŸ‘¤',
        color: '#3b82f6',
        playerCount: 2 // ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù„Ù€ 4
      });
      
      showNotification('ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨ÙŠÙ†...');
      
      showWaitingScreen();
    }

    function showWaitingScreen() {
      hideAllScreens();
      
      const waitingScreen = document.createElement('div');
      waitingScreen.id = 'waitingScreen';
      waitingScreen.className = 'fixed inset-0 bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center p-4 z-50';
      waitingScreen.innerHTML = `
        <div class="bg-white rounded-3xl p-10 shadow-2xl text-center max-w-md w-full">
          <div class="text-6xl mb-6">ğŸ®</div>
          <h2 class="text-3xl font-bold mb-3" style="color: #667eea;">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù„Ø§Ø¹Ø¨ÙŠÙ†</h2>
          <p class="text-gray-600 mb-8 text-lg">Ø§Ù†ØªØ¸Ø± Ø­ØªÙ‰ Ù†Ø¬Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø¢Ø®Ø±ÙŠÙ† Ù„Ù„Ø¹Ø¨ Ù…Ø¹Ùƒ</p>
          
          <div class="w-20 h-20 border-6 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
          
          <div class="space-y-4 mb-8">
            <div class="flex items-center justify-between">
              <span class="text-gray-700">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†:</span>
              <span class="font-bold text-blue-600" id="connectedPlayersCount">1</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-gray-700">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ù†Ù‚Ø¶ÙŠ:</span>
              <span class="font-bold text-green-600" id="waitingTime">0:00</span>
            </div>
          </div>
          
          <div class="flex gap-4">
            <button onclick="cancelGameSearch()" class="flex-1 bg-gradient-to-r from-gray-400 to-gray-500 text-white text-xl font-bold py-4 px-8 rounded-2xl hover:from-gray-500 hover:to-gray-600 transition-all">
              Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø«
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(waitingScreen);
      
      let seconds = 0;
      waitingTimer = setInterval(() => {
        seconds++;
        const timeElement = document.getElementById('waitingTime');
        if (timeElement) {
          const minutes = Math.floor(seconds / 60);
          const secs = seconds % 60;
          timeElement.textContent = `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†
        const playersCountElement = document.getElementById('connectedPlayersCount');
        if (playersCountElement) {
          playersCountElement.textContent = socket && socket.connected ? '2+' : '1';
        }
      }, 1000);
    }

    function cancelGameSearch() {
      isSearchingForGame = false;
      
      if (socket && socket.connected) {
        socket.emit('cancel-search');
      }
      
      if (waitingTimer) {
        clearInterval(waitingTimer);
        waitingTimer = null;
      }
      
      const waitingScreen = document.getElementById('waitingScreen');
      if (waitingScreen) {
        waitingScreen.remove();
      }
      
      showNotification('âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù„Ø¹Ø¨Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©');
      showStartScreen();
    }

    function startOnlineGame(gameData) {
      const waitingScreen = document.getElementById('waitingScreen');
      if (waitingScreen) {
        waitingScreen.remove();
      }
      
      if (waitingTimer) {
        clearInterval(waitingTimer);
        waitingTimer = null;
      }
      
      hideAllScreens();
      document.getElementById('gameScreen').classList.remove('hidden');
      
      if (musicEnabled) {
        playGameplayMusic();
      }
      
      showNotification('ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ø¨Ø¯Ø£Øª! Ø­Ø¸Ø§Ù‹ Ø·ÙŠØ¨Ø§Ù‹ Ù„Ù„Ø¬Ù…ÙŠØ¹');
      
      gameState = {
        deck: [],
        players: gameData.players.map((player, index) => ({
          id: player.id,
          name: player.name,
          hand: [],
          announced: false,
          icon: player.icon || 'ğŸ‘¤',
          color: player.color || PLAYER_COLORS[index % PLAYER_COLORS.length],
          isAI: false,
          socketId: player.id,
          isOnline: true
        })),
        currentCard: null,
        currentPlayerIndex: 0,
        direction: 1,
        drawPileCards: 0,
        totalPlayers: gameData.players.length,
        isOnlineGame: true
      };
      
      const deck = createDeck();
      gameState.deck = deck;
      
      gameState.players.forEach(player => {
        player.hand = deck.splice(0, 7);
      });
      
      do {
        gameState.currentCard = deck.splice(0, 1)[0];
      } while (gameState.currentCard.type !== "city");
      
      gameState.drawPileCards = deck.length;
      
      renderGame();
      updateMusicButtonVisibility();
      
      const onlineInfo = document.createElement('div');
      onlineInfo.className = 'fixed top-4 left-4 bg-black bg-opacity-70 text-white px-4 py-2 rounded-xl text-sm';
      onlineInfo.innerHTML = `ğŸŸ¢ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª: ${gameData.players.length}`;
      document.getElementById('gameScreen').appendChild(onlineInfo);
    }

    function updateOnlineGame(gameData) {
      if (!gameState.isOnlineGame) return;
      
      gameState.currentCard = gameData.currentCard;
      gameState.currentPlayerIndex = gameData.currentPlayerIndex;
      gameState.direction = gameData.direction;
      gameState.drawPileCards = gameData.drawPileCards;
      
      gameData.players.forEach((playerData, index) => {
        if (index < gameState.players.length) {
          gameState.players[index].hand = playerData.hand;
          gameState.players[index].announced = playerData.announced;
        }
      });
      
      renderGame();
    }

    function sendOnlineMove(cardIndex, card) {
      if (!socket || !gameState.isOnlineGame) return;
      
      socket.emit('play-card', {
        cardIndex: cardIndex,
        card: card
      });
    }
    
    // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
    
    function updateConnectionStatus(status) {
      const statusEl = document.getElementById('connectionStatus');
      if (!statusEl) return;
      
      statusEl.classList.remove('hidden', 'connected', 'disconnected', 'connecting');
      
      switch(status) {
        case 'connected':
          statusEl.classList.add('connected');
          statusEl.innerHTML = `
            <div class="w-3 h-3 rounded-full bg-green-400 animate-pulse"></div>
            <span>Ù…ØªØµÙ„</span>
          `;
          break;
        case 'disconnected':
          statusEl.classList.add('disconnected');
          statusEl.innerHTML = `
            <div class="w-3 h-3 rounded-full bg-red-400"></div>
            <span>ØºÙŠØ± Ù…ØªØµÙ„</span>
          `;
          break;
        case 'connecting':
          statusEl.classList.add('connecting');
          statusEl.innerHTML = `
            <div class="w-3 h-3 rounded-full bg-yellow-400 animate-pulse"></div>
            <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
          `;
          break;
      }
      
      statusEl.classList.remove('hidden');
    }
    
    // ==================== Ù†Ø¸Ø§Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø³Ø¨Ù‚ ====================
    
    function getAllImageUrls() {
      const imageUrls = new Set();
      
      Object.values(CITY_IMAGES).forEach(city => {
        Object.values(city).forEach(url => {
          if (url && typeof url === 'string') {
            imageUrls.add(url);
          }
        });
      });
      
      SPECIAL_CARDS.forEach(card => {
        if (card.imageUrl) {
          imageUrls.add(card.imageUrl);
        }
      });
      
      imageUrls.add("https://i.ibb.co/nsGRxS63/1.png");
      imageUrls.add("https://i.ibb.co/C36ywmnL/3.png");
      
      CITIES.forEach(city => {
        COLORS.forEach(color => {
          const cityName = city.name;
          const colorName = color.name;
          if (CITY_IMAGES[cityName] && CITY_IMAGES[cityName][colorName]) {
            imageUrls.add(CITY_IMAGES[cityName][colorName]);
          }
        });
      });
      
      return Array.from(imageUrls);
    }
    
    function loadSingleImage(url) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        
        img.onload = () => {
          loadedImagesCount++;
          updateImageProgress();
          resolve(url);
        };
        
        img.onerror = () => {
          console.warn(`ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©: ${url}`);
          loadedImagesCount++;
          updateImageProgress();
          resolve(url);
        };
        
        img.crossOrigin = "anonymous";
        img.src = url;
      });
    }
    
    function updateImageProgress() {
      if (!imageProgressBar || !imageProgressText || !imageStatusText) return;
      
      const progress = Math.round((loadedImagesCount / totalImagesToLoad) * 100);
      imageProgressBar.style.width = `${progress}%`;
      imageProgressText.textContent = `${progress}%`;
      
      if (progress < 30) {
        imageStatusText.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ± Ø§Ù„Ù…Ø¯Ù†...";
      } else if (progress < 60) {
        imageStatusText.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø®Ø§ØµØ©...";
      } else if (progress < 90) {
        imageStatusText.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©...";
      } else {
        imageStatusText.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ...";
      }
      
      updateStartButton();
      
      if (loadedImagesCount >= totalImagesToLoad && !allImagesLoaded) {
        allImagesLoaded = true;
        updateStartButton();
        document.body.classList.add('images-loaded');
        document.body.classList.remove('images-loading');
        
        setTimeout(() => {
          showNotification("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ±ØŒ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ø¨!");
        }, 100);
        
        setTimeout(hideImageLoadingScreen, 1000);
      }
    }
    
    async function preloadAllGameImages() {
      const allImageUrls = getAllImageUrls();
      totalImagesToLoad = allImageUrls.length;
      loadedImagesCount = 0;
      allImagesLoaded = false;
      
      console.log(`Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ ${totalImagesToLoad} ØµÙˆØ±Ø©...`);
      
      showImageLoadingScreen();
      
      updateImageProgress();
      
      const batchSize = 10;
      for (let i = 0; i < allImageUrls.length; i += batchSize) {
        const batch = allImageUrls.slice(i, i + batchSize);
        const promises = batch.map(url => loadSingleImage(url));
        
        try {
          await Promise.all(promises);
          
          if (i + batchSize < allImageUrls.length) {
            await new Promise(resolve => setTimeout(resolve, 100));
          }
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¯ÙØ¹Ø© Ø§Ù„ØµÙˆØ±:', error);
        }
      }
      
      if (loadedImagesCount < totalImagesToLoad) {
        loadedImagesCount = totalImagesToLoad;
        allImagesLoaded = true;
        updateImageProgress();
        setTimeout(hideImageLoadingScreen, 500);
      }
    }
    
    function showImageLoadingScreen() {
      imageLoadingScreen = document.getElementById('imageLoadingScreen');
      imageProgressBar = document.getElementById('imageProgressBar');
      imageProgressText = document.getElementById('imageProgressText');
      imageStatusText = document.getElementById('imageStatusText');
      
      if (imageLoadingScreen) {
        imageLoadingScreen.classList.remove('hidden');
      }
    }
    
    function hideImageLoadingScreen() {
      if (imageLoadingScreen) {
        imageLoadingScreen.style.opacity = '0';
        setTimeout(() => {
          imageLoadingScreen.classList.add('hidden');
          const mainLoadingScreen = document.getElementById('loadingScreen');
          if (mainLoadingScreen) {
            mainLoadingScreen.style.opacity = '0';
            setTimeout(() => mainLoadingScreen.remove(), 500);
          }
        }, 500);
      }
    }
    
    function updateStartButton() {
      const startButtonText = document.getElementById('startButtonText');
      const startButton = document.getElementById('startGameButton');
      
      if (!allImagesLoaded) {
        if (startButtonText) {
          startButtonText.textContent = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±...";
        }
        if (startButton) {
          startButton.classList.add('start-btn-loading');
          startButton.disabled = true;
          document.body.classList.add('images-loading');
        }
      } else {
        if (startButtonText) {
          startButtonText.textContent = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨";
        }
        if (startButton) {
          startButton.classList.remove('start-btn-loading');
          startButton.disabled = false;
        }
      }
    }
    
    // ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØµÙˆØª ====================
    function playSound(soundId) {
      try {
        if (isLowPerfDevice) return;
        
        const sound = document.getElementById(soundId);
        if (sound) {
          sound.currentTime = 0;
          sound.play().catch(e => {
            if (!e.message.includes('user didn\'t interact')) {
              console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
            }
          });
        }
      } catch (e) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª:', e);
      }
    }
    
    // ==================== Ø§ÙƒØªØ´Ø§Ù Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ù‡Ø§Ø² ====================
    function detectDevicePerformance() {
      try {
        const memory = navigator.deviceMemory || 4;
        const cores = navigator.hardwareConcurrency || 4;
        isLowPerfDevice = memory < 4 || cores < 4;
        
        if (isLowPerfDevice) {
          document.body.classList.add('low-performance');
          console.log('ØªÙ… Ø§ÙƒØªØ´Ø§Ù Ø¬Ù‡Ø§Ø² Ø°Ùˆ Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø¯ÙˆØ¯ØŒ Ø³ÙŠØªÙ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª');
        }
      } catch (e) {
        console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§ÙƒØªØ´Ø§Ù Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¬Ù‡Ø§Ø²:', e);
      }
    }
    
    // ==================== ØªÙ‡ÙŠØ¦Ø© SDK ====================
    function initSDKs() {
      console.log('Ù…Ù„ÙØ§Øª SDK ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø¯ÙˆÙ†Ù‡Ø§');
      initDataSdk();
    }
    
    async function initDataSdk() {
      console.warn('Data SDK ØºÙŠØ± Ù…ØªÙˆÙØ±ØŒ Ø³ÙŠØªÙ… Ù„Ø¹Ø¨ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¯ÙˆÙ† Ø­ÙØ¸ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
      return;
    }
    
    // ==================== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ ====================
    function clearAllEffects() {
      activeEffects.forEach(effect => {
        try {
          effect.remove();
        } catch (e) {
        }
      });
      activeEffects.clear();
    }
    
    // ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ====================
    function closeModal() {
      const modals = document.querySelectorAll('.modal-overlay');
      modals.forEach(modal => {
        modal.style.opacity = '0';
        setTimeout(() => modal.remove(), 300);
      });
      
      tempUploadFile = null;
    }
    
    function showNotification(message, duration = 3000) {
      const shouldPlaySound = document.body.classList.contains('user-interacted');
      if (shouldPlaySound) {
        playSound('notificationSound');
      }
      
      const existingNotif = document.querySelector('.notification');
      if (existingNotif) {
        existingNotif.remove();
      }
      
      const notif = document.createElement('div');
      notif.className = 'notification';
      notif.textContent = message;
      document.body.appendChild(notif);
      
      setTimeout(() => {
        if (notif.parentNode) {
          notif.style.opacity = '0';
          setTimeout(() => notif.remove(), 300);
        }
      }, duration);
    }
    
    // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ ====================
    function showLeaderboard() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
          <p class="text-gray-600 mb-8 text-lg">Ø£ÙØ¶Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
          
          <div class="space-y-4 mb-8">
            <div class="leaderboard-entry first">
              <div class="flex items-center gap-4">
                <span class="text-4xl">ğŸ¥‡</span>
                <div class="text-3xl w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-r from-yellow-500 to-yellow-600">
                  ğŸ‘‘
                </div>
                <div>
                  <p class="font-bold text-xl">Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø£ÙˆÙ„</p>
                  <p class="text-base text-gray-600">+150 Ù†Ù‚Ø·Ø©</p>
                </div>
              </div>
              <div class="text-left">
                <p class="font-bold text-3xl text-green-600">1</p>
                <p class="text-sm text-gray-500">Ù…Ø±ÙƒØ²</p>
              </div>
            </div>
            
            <div class="leaderboard-entry second">
              <div class="flex items-center gap-4">
                <span class="text-4xl">ğŸ¥ˆ</span>
                <div class="text-3xl w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-r from-gray-400 to-gray-500">
                  ğŸ¤–
                </div>
                <div>
                  <p class="font-bold text-xl">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
                  <p class="text-base text-gray-600">+120 Ù†Ù‚Ø·Ø©</p>
                </div>
              </div>
              <div class="text-left">
                <p class="font-bold text-3xl text-blue-600">2</p>
                <p class="text-sm text-gray-500">Ù…Ø±ÙƒØ²</p>
              </div>
            </div>
            
            <div class="leaderboard-entry third">
              <div class="flex items-center gap-4">
                <span class="text-4xl">ğŸ¥‰</span>
                <div class="text-3xl w-12 h-12 rounded-full flex items-center justify-center bg-gradient-to-r from-orange-500 to-orange-600">
                  ğŸ‘¤
                </div>
                <div>
                  <p class="font-bold text-xl">Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</p>
                  <p class="text-base text-gray-600">+100 Ù†Ù‚Ø·Ø©</p>
                </div>
              </div>
              <div class="text-left">
                <p class="font-bold text-3xl text-orange-600">3</p>
                <p class="text-sm text-gray-500">Ù…Ø±ÙƒØ²</p>
              </div>
            </div>
          </div>
          
          <div class="text-center text-gray-500 mb-6">
            <p>âœ¨ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ù„ØªØ­Ø³ÙŠÙ† ØªØ±ØªÙŠØ¨Ùƒ!</p>
          </div>
          
          <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ø§Ù‹!
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function showAchievements() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h2>
          <p class="text-gray-600 mb-8 text-lg">Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©</p>
          
          <div class="space-y-4 mb-8">
            <div class="achievement-badge">
              <span>ğŸ®</span>
              <span>Ø£ÙˆÙ„ Ù…Ø¨Ø§Ø±Ø§Ø©</span>
            </div>
            
            <div class="achievement-badge">
              <span>ğŸ†</span>
              <span>Ø§Ù„ÙÙˆØ² Ø§Ù„Ø£ÙˆÙ„</span>
            </div>
            
            <div class="achievement-badge">
              <span>ğŸ´</span>
              <span>10 Ù…Ø¨Ø§Ø±ÙŠØ§Øª</span>
            </div>
            
            <div class="achievement-badge">
              <span>âš¡</span>
              <span>ÙÙˆØ² Ø³Ø±ÙŠØ¹</span>
            </div>
            
            <div class="achievement-badge locked">
              <span>ğŸ‘‘</span>
              <span>5 Ø§Ù†ØªØµØ§Ø±Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ©</span>
            </div>
            
            <div class="achievement-badge locked">
              <span>ğŸŒŸ</span>
              <span>Ø®Ø¨ÙŠØ± Ø§Ù„Ù„Ø¹Ø¨Ø©</span>
            </div>
            
            <div class="achievement-badge locked">
              <span>ğŸ’</span>
              <span>Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</span>
            </div>
          </div>
          
          <div class="text-center text-gray-500 mb-6">
            <p>âœ¨ Ø£ÙƒÙ…Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù„ÙØªØ­ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª!</p>
          </div>
          
          <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ø§Ù‹!
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function showMatchHistory() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h2>
          <p class="text-gray-600 mb-8 text-lg">Ø¢Ø®Ø± 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù„Ùƒ</p>
          
          <div class="space-y-4 mb-8">
            <div class="match-history-item win">
              <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-lg">ğŸ‰ ÙÙˆØ²</span>
                <span class="text-gray-500 text-sm">Ø§Ù„ÙŠÙˆÙ…</span>
              </div>
              <p class="text-gray-700">ÙØ²Øª Ø¶Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù€ 120 Ù†Ù‚Ø·Ø©</p>
            </div>
            
            <div class="match-history-item loss">
              <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-lg">ğŸ˜” Ø®Ø³Ø§Ø±Ø©</span>
                <span class="text-gray-500 text-sm">Ø£Ù…Ø³</span>
              </div>
              <p class="text-gray-700">Ø®Ø³Ø±Øª Ø¶Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù€ 80 Ù†Ù‚Ø·Ø©</p>
            </div>
            
            <div class="match-history-item win">
              <div class="flex justify-between items-center mb-2">
                <span class="font-bold text-lg">ğŸ‰ ÙÙˆØ²</span>
                <span class="text-gray-500 text-sm">Ù‚Ø¨Ù„ ÙŠÙˆÙ…ÙŠÙ†</span>
              </div>
              <p class="text-gray-700">ÙØ²Øª Ø¶Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù€ 150 Ù†Ù‚Ø·Ø©</p>
            </div>
          </div>
          
          <div class="text-center text-gray-500 mb-6">
            <p>âœ¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª: 3 | Ø§Ù„ÙÙˆØ²: 2 | Ø§Ù„Ø®Ø³Ø§Ø±Ø©: 1</p>
          </div>
          
          <button onclick="closeModal()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ø§Ù‹!
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // ==================== Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================
    function selectGameMode(mode) {
      gameMode = mode;
      
      document.getElementById('mode-ai').classList.toggle('selected', mode === 'ai');
      document.getElementById('mode-online').classList.toggle('selected', mode === 'online');
      
      const playerCountSection = document.getElementById('playerCountSection');
      if (mode === 'ai') {
        playerCountSection.style.display = 'block';
        selectedPlayerCount = 2;
        document.getElementById('players-2').classList.add('selected');
        document.getElementById('players-2').classList.remove('bg-gray-300', 'text-gray-700');
        document.getElementById('players-2').classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white');
        
        if (socket) {
          socket.disconnect();
          socket = null;
        }
      } else if (mode === 'online') {
        playerCountSection.style.display = 'none';
        
        setTimeout(() => {
          connectToServer();
        }, 500);
      }
    }
    
    function selectPlayers(count) {
      selectedPlayerCount = count;
      
      const btn = document.getElementById('players-2');
      if (count === 2) {
        btn.classList.add('selected');
        btn.classList.remove('bg-gray-300', 'text-gray-700');
        btn.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-600', 'text-white');
      }
    }
    
    function handleStartButton() {
      if (!allImagesLoaded) {
        showNotification("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
        return;
      }
      
      if (musicEnabled) {
        playGameplayMusic();
      }
      
      if (gameMode === 'online') {
        searchForOnlineGame();
      } else {
        goToNamesScreen();
      }
    }
    
    function goToNamesScreen() {
      if (!allImagesLoaded) {
        showNotification("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
        return;
      }
  
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('namesScreen').classList.remove('hidden');
  
      const playerInputsDiv = document.getElementById('playerInputs');
      playerInputsDiv.innerHTML = '';
  
      selectedPlayerIcons = [];
      customPlayerImages = {};
  
      const actualPlayerCount = gameMode === 'ai' ? 1 : selectedPlayerCount;
  
      for (let i = 0; i < actualPlayerCount; i++) {
        selectedPlayerIcons.push(PLAYER_ICONS[i % PLAYER_ICONS.length]);
      }
  
      for (let i = 0; i < actualPlayerCount; i++) {
        const inputBox = document.createElement('div');
        inputBox.className = 'player-input-box';
    
        let defaultName = '';
        if (i === 0 && currentUser && currentUser.name) {
          defaultName = currentUser.name;
        } else {
          defaultName = gameMode === 'ai' ? 'Ø£Ù†Øª' : (i === 0 ? 'Ø£Ù†Øª' : 'Ù„Ø§Ø¹Ø¨ ' + (i + 1));
        }
    
        inputBox.innerHTML = `
          <div class="flex items-center gap-4 mb-4">
            <div id="player-icon-${i}" class="text-4xl w-16 h-16 rounded-full flex items-center justify-center cursor-pointer hover:scale-115 transition-all overflow-hidden" style="background: ${PLAYER_COLORS[i]};">
              ${customPlayerImages[i] ? `<img src="${customPlayerImages[i]}" class="custom-image-icon" alt="ØµÙˆØ±Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨" />` : selectedPlayerIcons[i]}
            </div>
            <div class="flex-1">
              <label class="text-gray-700 font-bold text-xl block mb-2">Ø§Ù„Ù„Ø§Ø¹Ø¨ ${i + 1}</label>
              <button onclick="openIconPicker(${i})" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-xl hover:bg-gray-300 transition-all text-sm">
                ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
              </button>
            </div>
          </div>
          <input 
            type="text" 
            id="player-name-${i}" 
            class="w-full p-3 border-2 border-gray-300 rounded-xl text-lg text-center" 
            placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§..."
            maxlength="15"
            value="${defaultName}"
          />
        `;
        playerInputsDiv.appendChild(inputBox);
      }
  
      setTimeout(() => {
        document.getElementById('player-name-0').select();
      }, 100);
    }
    
    function backToStart() {
      document.getElementById('namesScreen').classList.add('hidden');
      showStartScreen();
      clearAllEffects();
    }
    
    function showStartScreen() {
      hideAllScreens();
      document.getElementById('startScreen').classList.remove('hidden');
      updateMusicButtonVisibility();
      
      if (musicEnabled) {
        playMainMenuMusic();
      }
      
      updateUserStatusBar();
    }
    
    // ==================== Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ====================
    function startGameWithNames() {
      if (!allImagesLoaded) {
        showNotification("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±ØŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...");
        return;
      }
      
      const actualPlayerCount = gameMode === 'ai' ? 1 : selectedPlayerCount;
      
      playerNames = [];
      for (let i = 0; i < actualPlayerCount; i++) {
        const input = document.getElementById(`player-name-${i}`);
        const name = input.value.trim();
        if (name === '') {
          showNotification(`âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ ${i + 1}`);
          input.focus();
          return;
        }
        playerNames.push(name);
      }
      
      if (gameMode === 'ai') {
        playerNames.push(AI_NAMES[Math.floor(Math.random() * AI_NAMES.length)]);
        selectedPlayerIcons.push("ğŸ¤–");
      }
      
      document.getElementById('namesScreen').classList.add('hidden');
      document.getElementById('gameScreen').classList.remove('hidden');
      updateMusicButtonVisibility();
      
      gameState.deck = createDeck();
      gameState.totalPlayers = gameMode === 'ai' ? 2 : selectedPlayerCount;
      gameState.players = [];
      
      for (let i = 0; i < gameState.totalPlayers; i++) {
        gameState.players.push({
          id: i,
          name: playerNames[i],
          hand: gameState.deck.splice(0, 5),
          announced: false,
          icon: selectedPlayerIcons[i],
          customImage: customPlayerImages[i] || null,
          color: PLAYER_COLORS[i],
          isAI: gameMode === 'ai' && i === 1
        });
      }
      
      do {
        gameState.currentCard = gameState.deck.splice(0, 1)[0];
      } while (gameState.currentCard.type !== "city");
      
      gameState.drawPileCards = gameState.deck.length;
      gameState.currentPlayerIndex = 0;
      gameState.direction = 1;
      
      renderGame();
      showNotification(`ğŸ® Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø© - Ø¯ÙˆØ± ${gameState.players[0].name}!`);
      addBounceEffect('currentCard');
      
      localStorage.removeItem('saudiTourGameState');
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ====================
    function createDeck() {
      const deck = [];
      
      CITIES.forEach(city => {
        COLORS.forEach(color => {
          for (let i = 0; i < 2; i++) {
            deck.push({
              type: "city",
              city: city.name,
              color: color.name,
              colorValue: color.value,
              imageUrl: CITY_IMAGES[city.name][color.name]
            });
          }
        });
      });
      
      SPECIAL_CARDS.forEach(specialCard => {
        for (let i = 0; i < 4; i++) {
          deck.push({
            type: specialCard.type,
            name: specialCard.name,
            imageUrl: specialCard.imageUrl,
            color: null,
            colorValue: specialCard.type.includes("wild") ? "#6b21a8" : "#8b5cf6"
          });
        }
      });
      
      return shuffleDeck(deck);
    }
    
    function shuffleDeck(deck) {
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }
    
    function renderCard(card) {
      if (card.type === "city" || card.type === "skip" || card.type === "reverse" || card.type === "draw2" || card.type === "wildColor" || card.type === "wildCity") {
        return `
          <div style="width: 100%; height: 100%; border-radius: 14px; overflow: hidden; position: relative;">
            <img 
              src="${card.imageUrl}" 
              alt="${card.city || card.name}" 
              loading="lazy"
              decoding="async"
              style="width: 100%; height: 100%; object-fit: cover; position: relative; z-index: 2;"
            >
          </div>
        `;
      }
      
      return `
        <div style="background: ${card.colorValue}; width: 100%; height: 100%; border-radius: 14px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 6px; color: white; font-weight: bold;">
          <div style="font-size: 28px;">${card.city || card.name}</div>
        </div>
      `;
    }
    
    function canPlayCard(card, currentCard) {
      if (currentCard.type === "wildColor") {
        if (card.type === "city" && card.color === currentCard.color) {
          return true;
        }
        if (card.type === "wildColor") {
          return true;
        }
        return false;
      }
      
      if (currentCard.type === "wildCity") {
        if (card.type === "city" && card.city === currentCard.city) {
          return true;
        }
        if (card.type === "wildCity") {
          return true;
        }
        return false;
      }
      
      if (card.type === "wildColor") {
        return currentCard.type === "city" || currentCard.type === "wildColor";
      }
      
      if (card.type === "wildCity") {
        return currentCard.type === "city" || currentCard.type === "wildCity";
      }
      
      if (card.type === "skip" || card.type === "reverse" || card.type === "draw2") {
        return currentCard.type !== "wildColor" && currentCard.type !== "wildCity";
      }
      
      if (currentCard.type === "city") {
        if (card.color && currentCard.color && card.color === currentCard.color) {
          return true;
        }
        if (card.type === "city" && card.city === currentCard.city) {
          return true;
        }
      }
      
      if (currentCard.type === "skip" || currentCard.type === "reverse" || currentCard.type === "draw2") {
        return true;
      }
      
      return false;
    }
    
    // ==================== Ø±Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© ====================
    function renderGame() {
      document.getElementById('drawPileCount').textContent = gameState.deck.length;
      
      const currentCardEl = document.getElementById('currentCard');
      currentCardEl.innerHTML = renderCard(gameState.currentCard);
      currentCardEl.classList.add('current-card');
      
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      
      const otherPlayersArea = document.getElementById('otherPlayersArea');
      otherPlayersArea.innerHTML = '';
      
      gameState.players.forEach((player, index) => {
        if (index !== 0) {
          const isActive = index === gameState.currentPlayerIndex;
          const playerBox = document.createElement('div');
          playerBox.className = `player-box ${isActive ? 'active' : ''}`;
          playerBox.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-2xl overflow-hidden" style="background: ${player.color};">
                  ${player.customImage ? `<img src="${player.customImage}" class="custom-image-icon" alt="${player.name}" />` : player.icon}
                </div>
                <div>
                  <p class="text-white font-bold text-xl">${player.name}</p>
                  <p class="text-white text-base">Ø¨Ø·Ø§Ù‚Ø§Øª: <span class="font-bold">${player.hand.length}</span></p>
                </div>
              </div>
              <div class="flex gap-2 items-center">
                ${Array(Math.min(player.hand.length, 5)).fill(0).map(() => 
                  '<div class="card other-player-card"><img src="https://i.ibb.co/C36ywmnL/3.png" alt="Ø¸Ù‡Ø± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;"></div>'
                ).join('')}
                ${player.hand.length > 5 ? `<span class="text-white font-bold text-base mr-3">+${player.hand.length - 5}</span>` : ''}
              </div>
            </div>
          `;
          otherPlayersArea.appendChild(playerBox);
        }
      });
      
      const playerHandEl = document.getElementById('playerHand');
      playerHandEl.innerHTML = '';
      
      const humanPlayer = gameState.players[0];
      
      humanPlayer.hand.forEach((card, index) => {
        const cardContainer = document.createElement('div');
        cardContainer.className = 'mb-3';
        cardContainer.style.margin = '0 12px';
        
        const cardEl = document.createElement('div');
        cardEl.innerHTML = renderCard(card);
        cardEl.className = 'card';
        
        if (gameState.currentPlayerIndex === 0 && !humanPlayer.isAI && canPlayCard(card, gameState.currentCard)) {
          cardEl.classList.add('playable');
          cardEl.onclick = () => playCard(index);
        } else {
          cardEl.classList.add('disabled');
        }
        
        cardContainer.appendChild(cardEl);
        playerHandEl.appendChild(cardContainer);
      });
      
      document.getElementById('playerCardCount').textContent = humanPlayer.hand.length;
      document.getElementById('playerNameLabel').textContent = humanPlayer.name;
      const currentPlayerIconEl = document.getElementById('currentPlayerIcon');
      currentPlayerIconEl.style.background = humanPlayer.color;
      if (humanPlayer.customImage) {
        currentPlayerIconEl.innerHTML = `<img src="${humanPlayer.customImage}" class="custom-image-icon" alt="${humanPlayer.name}" />`;
        currentPlayerIconEl.classList.add('overflow-hidden');
      } else {
        currentPlayerIconEl.textContent = humanPlayer.icon;
        currentPlayerIconEl.classList.remove('overflow-hidden');
      }
      
      const unoButton = document.getElementById('unoButton');
      if (humanPlayer.hand.length === 2 && !humanPlayer.announced) {
        unoButton.classList.remove('hidden');
      } else {
        unoButton.classList.add('hidden');
      }
      
      document.getElementById('turnIndicator').textContent = currentPlayer.name;
      document.getElementById('directionIndicator').textContent = gameState.direction === 1 ? "â†“" : "â†‘";
      
      updateMusicButtonVisibility();
      
      checkWin();
      
      if (currentPlayer.isAI && !gameState.aiThinking && gameState.currentPlayerIndex !== 0) {
        setTimeout(() => {
          const stillCurrentPlayer = gameState.players[gameState.currentPlayerIndex];
          if (stillCurrentPlayer.isAI && !gameState.aiThinking) {
            aiPlay();
          }
        }, 800);
      }
    }
    
    // ==================== Ø¥Ø¹Ù„Ø§Ù† Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚Ø© ====================
    function announceUno() {
      const humanPlayer = gameState.players[0];
      
      if (humanPlayer.hand.length === 2 && !humanPlayer.announced) {
        humanPlayer.announced = true;
        playSound('notificationSound');
        showNotification("âœ… ØªÙ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù† Ø£Ù† Ù„Ø¯ÙŠÙƒ Ø¨Ø·Ø§Ù‚ØªÙŠÙ† Ù…ØªØ¨Ù‚ØªÙŠÙ†!");
        
        const unoButton = document.getElementById('unoButton');
        unoButton.classList.add('bounce-effect');
        setTimeout(() => {
          unoButton.classList.remove('bounce-effect');
          unoButton.classList.add('hidden');
        }, 600);
        
        const rect = unoButton.getBoundingClientRect();
        createSparkles(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          '#ef4444'
        );
      }
    }
    
    // ==================== Ø¯Ø§Ù„Ø© applyCardEffect Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ====================
    function applyCardEffect(card) {
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      const isTwoPlayers = gameState.totalPlayers === 2;
      
      if (currentPlayer.isAI && card.type === "wildColor") {
        const chosenColor = aiChooseColor(currentPlayer);
        gameState.currentCard.color = chosenColor.name;
        gameState.currentCard.colorValue = chosenColor.value;
        
        showPermanentNotificationForWildColor(chosenColor.name, chosenColor.value);
        
        switchTurn();
        return;
      }
      
      if (currentPlayer.isAI && card.type === "wildCity") {
        const chosenCity = aiChooseCity(currentPlayer);
        gameState.currentCard.city = chosenCity.name;
        
        showPermanentNotificationForWildCity(chosenCity.name);
        
        switchTurn();
        return;
      }
      
      if (!currentPlayer.isAI && card.type === "wildColor") {
        showColorPicker();
        return;
      }
      
      if (!currentPlayer.isAI && card.type === "wildCity") {
        showCityPicker();
        return;
      }
      
      if (isTwoPlayers) {
        if (card.type === "skip") {
          showNotification("â›” ØªØ®Ø·ÙŠ Ø¯ÙˆØ± Ø§Ù„Ø®ØµÙ… - ÙŠÙ„Ø¹Ø¨ Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!");
          addShakeEffect('turnIndicator');
          
          renderGame();
          
          if (currentPlayer.isAI) {
            setTimeout(() => {
              if (!gameState.aiThinking && gameState.currentPlayerIndex === currentPlayer.id) {
                aiPlay();
              }
            }, 800);
          }
          return;
        }
        
        if (card.type === "reverse") {
          showNotification("ğŸ”„ Ø¹ÙƒØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ - ÙŠÙ„Ø¹Ø¨ Ù†ÙØ³ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!");
          addSpinEffect('directionIndicator');
          
          renderGame();
          
          if (currentPlayer.isAI) {
            setTimeout(() => {
              if (!gameState.aiThinking && gameState.currentPlayerIndex === currentPlayer.id) {
                aiPlay();
              }
            }, 800);
          }
          return;
        }
        
        if (card.type === "draw2") {
          const nextPlayerIndex = getNextPlayerIndex();
          const nextPlayer = gameState.players[nextPlayerIndex];
          const drawn = gameState.deck.splice(0, 2);
          nextPlayer.hand.push(...drawn);
          showNotification(`â• ${nextPlayer.name} ÙŠØ³Ø­Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ†ØŒ Ø«Ù… ${currentPlayer.name} ÙŠÙ„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!`);
          addShakeEffect('otherPlayersArea');
          
          renderGame();
          
          if (currentPlayer.isAI) {
            setTimeout(() => {
              if (!gameState.aiThinking && gameState.currentPlayerIndex === currentPlayer.id) {
                aiPlay();
              }
            }, 800);
          }
          return;
        }
      }
      
      if (card.type === "skip") {
        showNotification("â›” ØªØ®Ø·ÙŠ Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„ØªØ§Ù„ÙŠ!");
        addShakeEffect('turnIndicator');
        switchTurn();
        switchTurn();
        return;
      }
      
      if (card.type === "reverse") {
        if (gameState.totalPlayers === 2) {
          return;
        } else {
          gameState.direction *= -1;
          showNotification("ğŸ”„ Ø¹ÙƒØ³ Ø§Ù„Ø§ØªØ¬Ø§Ù‡!");
          addSpinEffect('directionIndicator');
          switchTurn();
        }
        return;
      }
      
      if (card.type === "draw2") {
        const nextPlayerIndex = getNextPlayerIndex();
        const nextPlayer = gameState.players[nextPlayerIndex];
        const drawn = gameState.deck.splice(0, 2);
        nextPlayer.hand.push(...drawn);
        showNotification(`â• ${nextPlayer.name} ÙŠØ³Ø­Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ† ÙˆÙŠÙØªØ®Ø·Ù‰ Ø¯ÙˆØ±Ù‡!`);
        addShakeEffect('otherPlayersArea');
        switchTurn();
        switchTurn();
        return;
      }
      
      switchTurn();
    }
    
    // ==================== Ù„Ø¹Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ====================
    function playCard(cardIndex) {
      const humanPlayer = gameState.players[0];
      
      if (humanPlayer.hand.length === 2 && !humanPlayer.announced) {
        if (gameState.deck.length >= 2) {
          const penaltyCards = gameState.deck.splice(0, 2);
          humanPlayer.hand.push(...penaltyCards);
          showNotification(`âš ï¸ ${humanPlayer.name} Ù†Ø³ÙŠ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¹Ù† Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚ØªÙŠÙ†! - ÙŠØ³Ø­Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ† Ø¹Ù‚ÙˆØ¨Ø©`);
          addShakeEffect('playerHand');
          renderGame();
          return;
        }
      }
      
      playSound('cardPlaySound');
      
      const card = humanPlayer.hand[cardIndex];
      
      if (!canPlayCard(card, gameState.currentCard)) {
        showNotification("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù„Ø¹Ø¨ Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©!");
        addShakeEffect('playerHand');
        return;
      }
      
      const permanentNotifs = document.querySelectorAll('.permanent-notification');
      permanentNotifs.forEach(notif => notif.remove());
      
      const currentCardEl = document.getElementById('currentCard');
      const rect = currentCardEl.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      createSparkles(centerX, centerY, card.colorValue || "#8b5cf6");
      
      currentCardEl.classList.add('super-bounce-effect');
      setTimeout(() => {
        currentCardEl.classList.remove('super-bounce-effect');
        currentCardEl.classList.add('mega-spin-effect');
        setTimeout(() => currentCardEl.classList.remove('mega-spin-effect'), 1000);
      }, 800);
      
      humanPlayer.hand.splice(cardIndex, 1);
      gameState.currentCard = card;
      
      if (humanPlayer.hand.length === 1 && !humanPlayer.announced) {
        humanPlayer.announced = true;
        showNotification(`ğŸ”” ${humanPlayer.name} Ù„Ø¯ÙŠÙ‡ Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…ØªØ¨Ù‚ÙŠØ©!`);
        
        const playerHandEl = document.getElementById('playerHand');
        const rect = playerHandEl.getBoundingClientRect();
        
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            createSparkles(
              rect.left + rect.width / 2 + (Math.random() - 0.5) * 120,
              rect.top + rect.height / 2 + (Math.random() - 0.5) * 60,
              '#fbbf24'
            );
          }, i * 150);
        }
      }
      
      if (gameState.isOnlineGame) {
        sendOnlineMove(cardIndex, card);
      }
      
      applyCardEffect(card);
    }
    
    function getNextPlayerIndex() {
      let nextIndex = gameState.currentPlayerIndex + gameState.direction;
      if (nextIndex >= gameState.totalPlayers) nextIndex = 0;
      if (nextIndex < 0) nextIndex = gameState.totalPlayers - 1;
      return nextIndex;
    }
    
    function switchTurn() {
      gameState.currentPlayerIndex = getNextPlayerIndex();
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      
      renderGame();
      
      if (gameState.currentPlayerIndex === 0) {
        showNotification(`ğŸ¯ Ø¯ÙˆØ± ${currentPlayer.name}!`);
      } else if (currentPlayer.isAI && !gameState.aiThinking) {
        setTimeout(() => {
          if (!gameState.aiThinking && gameState.currentPlayerIndex === currentPlayer.id) {
            aiPlay();
          }
        }, 1000);
      }
    }
    
    // ==================== Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ====================
    function drawCard() {
      playSound('drawSound');
      
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      
      if (currentPlayer.isAI || gameState.currentPlayerIndex !== 0) {
        return;
      }
      
      if (gameState.deck.length === 0) {
        showNotification("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø³Ø­Ø¨!");
        addShakeEffect('drawPile');
        return;
      }
      
      const drawnCard = gameState.deck.splice(0, 1)[0];
      currentPlayer.hand.push(drawnCard);
      currentPlayer.announced = false;
      
      showNotification(`ğŸ´ ${currentPlayer.name} Ø³Ø­Ø¨ Ø¨Ø·Ø§Ù‚Ø©`);
      addBounceEffect('drawPile');
      
      if (canPlayCard(drawnCard, gameState.currentCard)) {
        renderGame();
      } else {
        switchTurn();
      }
    }
    
    // ==================== Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ====================
    function aiChooseBestCard(aiPlayer, currentCard) {
      const playableCards = aiPlayer.hand
        .map((card, index) => ({ card, index }))
        .filter(item => canPlayCard(item.card, currentCard));
      
      if (playableCards.length === 0) return null;
      
      let bestCard = playableCards[0];
      
      const draw2Cards = playableCards.filter(item => item.card.type === 'draw2');
      if (draw2Cards.length > 0) {
        return draw2Cards[0];
      }
      
      const specialCards = playableCards.filter(item => 
        item.card.type === 'skip' || item.card.type === 'reverse'
      );
      if (specialCards.length > 0) {
        return specialCards[0];
      }
      
      const perfectMatches = playableCards.filter(item => 
        item.card.type === 'city' && 
        currentCard.type === 'city' &&
        item.card.color === currentCard.color && 
        item.card.city === currentCard.city
      );
      if (perfectMatches.length > 0) {
        return perfectMatches[0];
      }
      
      const colorMatches = playableCards.filter(item => 
        item.card.color && currentCard.color && item.card.color === currentCard.color
      );
      if (colorMatches.length > 0) {
        return colorMatches[0];
      }
      
      const wildCards = playableCards.filter(item => 
        item.card.type === 'wildColor' || item.card.type === 'wildCity'
      );
      if (wildCards.length > 0) {
        return wildCards[0];
      }
      
      return bestCard;
    }
    
    function aiChooseColor(aiPlayer) {
      const colorCounts = {};
      COLORS.forEach(color => colorCounts[color.name] = 0);
      
      aiPlayer.hand.forEach(card => {
        if (card.color && colorCounts[card.color] !== undefined) {
          colorCounts[card.color]++;
        }
      });
      
      let bestColor = COLORS[0];
      let maxCount = 0;
      
      COLORS.forEach(color => {
        if (colorCounts[color.name] > maxCount) {
          maxCount = colorCounts[color.name];
          bestColor = color;
        }
      });
      
      return bestColor;
    }
    
    function aiChooseCity(aiPlayer) {
      const cityCounts = {};
      CITIES.forEach(city => cityCounts[city.name] = 0);
      
      aiPlayer.hand.forEach(card => {
        if (card.type === 'city' && cityCounts[card.city] !== undefined) {
          cityCounts[card.city]++;
        }
      });
      
      let bestCity = CITIES[0];
      let maxCount = 0;
      
      CITIES.forEach(city => {
        if (cityCounts[city.name] > maxCount) {
          maxCount = cityCounts[city.name];
          bestCity = city;
        }
      });
      
      return bestCity;
    }
    
    async function aiPlay() {
      if (gameState.aiThinking) return;
      gameState.aiThinking = true;
      
      try {
        const aiPlayer = gameState.players[gameState.currentPlayerIndex];
        
        if (!aiPlayer.isAI) {
          console.warn('Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆÙ„ÙƒÙ† Ø§Ù„Ø¯ÙˆØ± Ù„ÙŠØ³ Ù„Ù‡!');
          gameState.aiThinking = false;
          return;
        }
        
        const turnIndicator = document.getElementById('turnIndicator');
        turnIndicator.classList.add('ai-thinking');
        
        const thinkingTime = 500 + Math.random() * 1000;
        await new Promise(resolve => setTimeout(resolve, thinkingTime));
        
        turnIndicator.classList.remove('ai-thinking');
        
        if (aiPlayer.hand.length === 1 && !aiPlayer.announced) {
          aiPlayer.announced = true;
          showNotification(`ğŸ”” ${aiPlayer.name} Ù„Ø¯ÙŠÙ‡ Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…ØªØ¨Ù‚ÙŠØ©!`);
          await new Promise(resolve => setTimeout(resolve, 800));
        }
        
        const playableCards = aiPlayer.hand
          .map((card, index) => ({ card, index }))
          .filter(item => canPlayCard(item.card, gameState.currentCard));
        
        if (playableCards.length > 0) {
          let bestCard = playableCards[0];
          
          const draw2Cards = playableCards.filter(item => item.card.type === 'draw2');
          if (draw2Cards.length > 0) {
            bestCard = draw2Cards[0];
          }
          
          const skipCards = playableCards.filter(item => item.card.type === 'skip');
          if (skipCards.length > 0 && draw2Cards.length === 0) {
            bestCard = skipCards[0];
          }
          
          const reverseCards = playableCards.filter(item => item.card.type === 'reverse');
          if (reverseCards.length > 0 && draw2Cards.length === 0 && skipCards.length === 0) {
            bestCard = reverseCards[0];
          }
          
          const wildColorCards = playableCards.filter(item => item.card.type === 'wildColor');
          if (wildColorCards.length > 0 && draw2Cards.length === 0 && skipCards.length === 0 && reverseCards.length === 0) {
            bestCard = wildColorCards[0];
          }
          
          const wildCityCards = playableCards.filter(item => item.card.type === 'wildCity');
          if (wildCityCards.length > 0 && draw2Cards.length === 0 && skipCards.length === 0 && reverseCards.length === 0 && wildColorCards.length === 0) {
            bestCard = wildCityCards[0];
          }
          
          const cardIndex = bestCard.index;
          const card = bestCard.card;
          
          playSound('cardPlaySound');
          
          const currentCardEl = document.getElementById('currentCard');
          const rect = currentCardEl.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          
          createSparkles(centerX, centerY, card.colorValue || "#8b5cf6");
          
          currentCardEl.classList.add('super-bounce-effect');
          setTimeout(() => {
            currentCardEl.classList.remove('super-bounce-effect');
            currentCardEl.classList.add('mega-spin-effect');
            setTimeout(() => currentCardEl.classList.remove('mega-spin-effect'), 1000);
          }, 800);
          
          aiPlayer.hand.splice(cardIndex, 1);
          gameState.currentCard = card;
          
          applyCardEffect(card);
          
        } else {
          if (gameState.deck.length > 0) {
            const drawnCard = gameState.deck.splice(0, 1)[0];
            aiPlayer.hand.push(drawnCard);
            aiPlayer.announced = false;
            
            showNotification(`ğŸ´ ${aiPlayer.name} Ø³Ø­Ø¨ Ø¨Ø·Ø§Ù‚Ø©`);
            addBounceEffect('drawPile');
            
            await new Promise(resolve => setTimeout(resolve, 500));
            
            if (canPlayCard(drawnCard, gameState.currentCard)) {
              const newCardIndex = aiPlayer.hand.length - 1;
              aiPlayer.hand.splice(newCardIndex, 1);
              gameState.currentCard = drawnCard;
              
              const currentCardEl = document.getElementById('currentCard');
              const rect = currentCardEl.getBoundingClientRect();
              createSparkles(rect.left + rect.width / 2, rect.top + rect.height / 2, drawnCard.colorValue || "#8b5cf6");
              
              setTimeout(() => {
                applyCardEffect(drawnCard);
              }, 800);
            } else {
              switchTurn();
            }
          } else {
            showNotification("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø³Ø­Ø¨!");
            switchTurn();
          }
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:', error);
        switchTurn();
      } finally {
        gameState.aiThinking = false;
      }
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¯Ù† ====================
    function showColorPicker() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ¨ Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</h2>
          <div class="grid grid-cols-2 gap-5">
            ${COLORS.map(color => `
              <button class="color-btn" style="background: ${color.value}; font-size: 18px;" onclick="selectColor('${color.name}', '${color.value}')">
                ${color.name}
              </button>
            `).join('')}
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function selectColor(colorName, colorValue) {
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      
      gameState.currentCard = {
        type: "wildColor",
        name: "ØªØºÙŠÙŠØ± Ù„ÙˆÙ†",
        color: colorName,
        colorValue: colorValue,
        imageUrl: "https://i.ibb.co/wNTGb1C9/41.png"
      };
      
      document.querySelector('.modal-overlay').remove();
      
      const oldNotifs = document.querySelectorAll('.permanent-notification');
      oldNotifs.forEach(notif => notif.remove());
      
      const notif = document.createElement('div');
      notif.className = 'notification permanent-notification';
      notif.id = 'wildColorNotification';
      notif.style.animation = 'none';
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.zIndex = '9999';
      notif.innerHTML = `
        <div class="text-center">
          <div class="text-3xl mb-2">ğŸ¨</div>
          <div class="text-xl font-bold" style="color: ${colorValue}">Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${colorName}</div>
          <p class="text-sm text-gray-300 mt-1">(ÙÙ‚Ø· Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯Ù† Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ù…Ù‚Ø¨ÙˆÙ„Ø©)</p>
        </div>
      `;
      
      document.body.appendChild(notif);
      
      const currentCardEl = document.getElementById('currentCard');
      currentCardEl.innerHTML = renderCard(gameState.currentCard);
      
      const rect = currentCardEl.getBoundingClientRect();
      createSparkles(rect.left + rect.width / 2, rect.top + rect.height / 2, colorValue);
      addSpinEffect('currentCard');
      
      switchTurn();
    }
    
    function showCityPicker() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ—ºï¸ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</h2>
          <div class="grid grid-cols-3 gap-4">
            ${CITIES.map(city => `
              <button class="city-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 16px;" onclick="selectCity('${city.name}')">
                <div class="text-3xl mb-2">ğŸ™ï¸</div>
                <div class="text-base">${city.name}</div>
              </button>
            `).join('')}
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    function selectCity(cityName) {
      const currentPlayer = gameState.players[gameState.currentPlayerIndex];
      
      gameState.currentCard = {
        type: "wildCity",
        name: "ØªØºÙŠÙŠØ± Ù…Ø¯ÙŠÙ†Ø©",
        city: cityName,
        color: "Ø£Ø­Ù…Ø±",
        colorValue: "#ef4444",
        imageUrl: "https://i.ibb.co/6R7kFGQF/42.png"
      };
      
      document.querySelector('.modal-overlay').remove();
      
      const oldNotifs = document.querySelectorAll('.permanent-notification');
      oldNotifs.forEach(notif => notif.remove());
      
      const notif = document.createElement('div');
      notif.className = 'notification permanent-notification';
      notif.id = 'wildCityNotification';
      notif.style.animation = 'none';
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.zIndex = '9999';
      notif.innerHTML = `
        <div class="text-center">
          <div class="text-3xl mb-2">ğŸ™ï¸</div>
          <div class="text-xl font-bold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${cityName}</div>
          <p class="text-sm text-gray-300 mt-1">(ÙÙ‚Ø· Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯Ù† Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ù…Ø¯ÙŠÙ†Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©)</p>
        </div>
      `;
      
      document.body.appendChild(notif);
      
      const currentCardEl = document.getElementById('currentCard');
      currentCardEl.innerHTML = renderCard(gameState.currentCard);
      
      const rect = currentCardEl.getBoundingClientRect();
      createSparkles(rect.left + rect.width / 2, rect.top + rect.height / 2, '#667eea');
      addSpinEffect('currentCard');
      
      switchTurn();
    }
    
    // ==================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ====================
    function showPermanentNotificationForWildColor(colorName, colorValue) {
      const oldNotifs = document.querySelectorAll('.permanent-notification');
      oldNotifs.forEach(notif => notif.remove());
      
      const notif = document.createElement('div');
      notif.className = 'notification permanent-notification';
      notif.id = 'wildColorNotification';
      notif.style.animation = 'none';
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.zIndex = '9999';
      notif.innerHTML = `
        <div class="text-center">
          <div class="text-3xl mb-2">ğŸ¨</div>
          <div class="text-xl font-bold" style="color: ${colorValue}">Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${colorName}</div>
          <p class="text-sm text-gray-300 mt-1">(ÙÙ‚Ø· Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯Ù† Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ù…Ù‚Ø¨ÙˆÙ„Ø©)</p>
        </div>
      `;
      
      document.body.appendChild(notif);
      
      showNotification(`ğŸ¨ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù„ÙˆÙ†: ${colorName}`);
    }
    
    function showPermanentNotificationForWildCity(cityName) {
      const oldNotifs = document.querySelectorAll('.permanent-notification');
      oldNotifs.forEach(notif => notif.remove());
      
      const notif = document.createElement('div');
      notif.className = 'notification permanent-notification';
      notif.id = 'wildCityNotification';
      notif.style.animation = 'none';
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.left = '50%';
      notif.style.transform = 'translateX(-50%)';
      notif.style.zIndex = '9999';
      notif.innerHTML = `
        <div class="text-center">
          <div class="text-3xl mb-2">ğŸ™ï¸</div>
          <div class="text-xl font-bold">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${cityName}</div>
          <p class="text-sm text-gray-300 mt-1">(ÙÙ‚Ø· Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯Ù† Ø£Ùˆ Ø¨Ø·Ø§Ù‚Ø© ØªØºÙŠÙŠØ± Ù…Ø¯ÙŠÙ†Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©)</p>
        </div>
      `;
      
      document.body.appendChild(notif);
      
      showNotification(`ğŸ™ï¸ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${cityName}`);
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ² ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ====================
    function checkWin() {
      gameState.players.forEach(player => {
        if (player.hand.length === 0) {
          setTimeout(() => {
            endGameWithStats(player);
          }, 500);
        }
      });
    }
    
    function calculatePoints(cards) {
      let points = 0;
      cards.forEach(card => {
        if (card.type === "city") {
          points += 5;
        } else if (card.type === "skip" || card.type === "reverse") {
          points += 20;
        } else if (card.type === "draw2") {
          points += 20;
        } else if (card.type === "wildColor" || card.type === "wildCity") {
          points += 50;
        }
      });
      return points;
    }
    
    async function endGameWithStats(winner) {
      stopAllMusic();
      
      playSound('winSound');
      
      if (!isLowPerfDevice) {
        createMegaFireworks();
        createConfetti();
        
        setTimeout(() => {
          createRainbowWave();
        }, 1000);
      }
      
      const playerResults = [];
      const opponentNames = [];
      
      for (const player of gameState.players) {
        const isWinner = player.id === winner.id;
        const points = isWinner ? 100 : 0;
        const penaltyPoints = calculatePoints(player.hand);
        const totalPoints = isWinner ? points + penaltyPoints : -penaltyPoints;
        
        playerResults.push({
          name: player.name,
          icon: player.icon,
          color: player.color,
          cards: player.hand.length,
          points: totalPoints,
          isWinner: isWinner,
          isAI: player.isAI
        });
        
        if (!isWinner) {
          opponentNames.push(player.name);
        }
      }
      
      playerResults.sort((a, b) => b.points - a.points);
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="trophy-icon pulse-glow-effect">ğŸ†</div>
          <h2 class="text-4xl font-bold mb-3 glow-text" style="color: #667eea;">${winner.name} ÙØ§Ø²!</h2>
          <p class="text-gray-600 mb-8 text-lg">Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</p>
          
          <div class="space-y-4 mb-8">
            ${playerResults.map((player, index) => `
              <div class="stats-card">
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center gap-4">
                    <span class="text-4xl">${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ“Š'}</span>
                    <div class="text-3xl w-12 h-12 rounded-full flex items-center justify-center" style="background: ${player.color};">
                      ${player.icon}
                    </div>
                    <div>
                      <p class="font-bold text-xl">${player.name}</p>
                      <p class="text-base text-gray-600">${player.cards} Ø¨Ø·Ø§Ù‚Ø© Ù…ØªØ¨Ù‚ÙŠØ©</p>
                    </div>
                  </div>
                  <div class="text-left">
                    <p class="font-bold text-3xl ${player.points >= 0 ? 'text-green-600' : 'text-red-600'}">
                      ${player.points >= 0 ? '+' : ''}${player.points}
                    </p>
                    <p class="text-sm text-gray-500">Ù†Ù‚Ø·Ø©</p>
                  </div>
                </div>
                ${player.isWinner ? `
                  <div class="text-center bg-green-100 rounded-xl py-3 mt-3">
                    <p class="text-green-700 font-bold text-base">ğŸ‰ +100 Ù†Ù‚Ø·Ø© ÙÙˆØ²</p>
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>
          
          <div class="flex gap-4">
            <button onclick="location.reload()" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-4 px-8 rounded-2xl hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-110 text-lg">
              Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      
      localStorage.removeItem('saudiTourGameState');
    }
    
    // ==================== Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ© ====================
    function createSparkles(x, y, color) {
      if (isLowPerfDevice) return;
      
      const container = document.createElement('div');
      container.className = 'sparkle-effect';
      container.style.left = x + 'px';
      container.style.top = y + 'px';
      
      const particleCount = isLowPerfDevice ? 4 : 10;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'sparkle-particle';
        particle.style.background = color;
        
        const angle = (Math.PI * 2 * i) / particleCount;
        const distance = 35 + Math.random() * 25;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        
        particle.style.setProperty('--tx', tx + 'px');
        particle.style.setProperty('--ty', ty + 'px');
        
        container.appendChild(particle);
      }
      
      document.body.appendChild(container);
      activeEffects.add(container);
      
      setTimeout(() => {
        container.remove();
        activeEffects.delete(container);
      }, 1000);
    }
    
    function createMegaFireworks() {
      if (isLowPerfDevice) return;
      
      const container = document.createElement('div');
      container.className = 'firework-container';
      document.body.appendChild(container);
      
      const colors = ['#ef4444', '#3b82f6', '#10b981', '#fbbf24', '#8b5cf6', '#ec4899', '#f97316'];
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      
      for (let f = 0; f < 4; f++) {
        setTimeout(() => {
          const startX = Math.random() * window.innerWidth;
          const startY = window.innerHeight;
          const targetX = centerX + (Math.random() - 0.5) * 300;
          const targetY = centerY - 150 + (Math.random() - 0.5) * 150;
          
          const rocket = document.createElement('div');
          rocket.className = 'rocket';
          rocket.textContent = 'ğŸš€';
          rocket.style.left = startX + 'px';
          rocket.style.top = startY + 'px';
          container.appendChild(rocket);
          
          setTimeout(() => {
            rocket.remove();
            
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            for (let c = 0; c < 2; c++) {
              setTimeout(() => {
                const explosionCircle = document.createElement('div');
                explosionCircle.className = 'explosion-circle';
                explosionCircle.style.borderColor = color;
                explosionCircle.style.left = targetX - 45 + 'px';
                explosionCircle.style.top = targetY - 45 + 'px';
                container.appendChild(explosionCircle);
                
                setTimeout(() => explosionCircle.remove(), 1000);
              }, c * 200);
            }
          }, 1200);
        }, f * 500);
      }
      
      setTimeout(() => container.remove(), 4 * 500 + 2500);
    }
    
    function createConfetti() {
      if (isLowPerfDevice) return;
      
      const container = document.createElement('div');
      container.className = 'firework-container';
      document.body.appendChild(container);
      
      const colors = ['#ef4444', '#3b82f6', '#10b981', '#fbbf24', '#8b5cf6', '#ec4899'];
      const shapes = ['â–€', 'â–„', 'â– ', 'â—', 'â™¦', 'â˜…'];
      
      for (let i = 0; i < 80; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = '-20px';
          confetti.style.color = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.fontSize = (12 + Math.random() * 12) + 'px';
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
          
          container.appendChild(confetti);
          setTimeout(() => confetti.remove(), 5000);
        }, i * 30);
      }
      
      setTimeout(() => container.remove(), 6000);
    }
    
    function createRainbowWave() {
      if (isLowPerfDevice) return;
      
      const colors = ['#ef4444', '#f97316', '#fbbf24', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'];
      const points = 10;
      
      for (let i = 0; i < points; i++) {
        setTimeout(() => {
          const x = (window.innerWidth / points) * i;
          const y = window.innerHeight / 2;
          const color = colors[i % colors.length];
          
          createSparkles(x, y, color);
        }, i * 100);
      }
    }
    
    function addShakeEffect(elementId) {
      const element = document.getElementById(elementId);
      if (element && !element.classList.contains('shake-effect')) {
        element.classList.add('shake-effect');
        setTimeout(() => {
          if (element) element.classList.remove('shake-effect');
        }, 500);
      }
    }
    
    function addBounceEffect(elementId) {
      const element = document.getElementById(elementId);
      if (element && !element.classList.contains('bounce-effect')) {
        element.classList.add('bounce-effect');
        setTimeout(() => {
          if (element) element.classList.remove('bounce-effect');
        }, 600);
      }
    }
    
    function addSpinEffect(elementId) {
      const element = document.getElementById(elementId);
      if (element && !element.classList.contains('spin-effect')) {
        element.classList.add('spin-effect');
        setTimeout(() => {
          if (element) element.classList.remove('spin-effect');
        }, 600);
      }
    }
    
    // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
    function showHelp() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 550px;">
          <h2 class="text-2xl font-bold mb-5" style="color: #667eea;">ğŸ® Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
          
          <div class="space-y-5 text-right">
            <div class="bg-blue-50 p-5 rounded-xl">
              <h3 class="font-bold text-xl mb-3">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù</h3>
              <p class="text-gray-700 text-lg">Ø§Ù„ØªØ®Ù„Øµ Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§ØªÙƒ Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙˆÙ…</p>
            </div>
            
            <div class="bg-green-50 p-5 rounded-xl">
              <h3 class="font-bold text-xl mb-3">ğŸƒ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h3>
              <ul class="space-y-3 text-gray-700 text-lg">
                <li>â€¢ <span style="color: #ef4444">Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</span>: ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù„ÙˆÙ† Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</li>
                <li>â€¢ <span style="color: #8b5cf6">Ø¨Ø·Ø§Ù‚Ø§Øª Ø®Ø§ØµØ©</span>: ØªÙ„Ø¹Ø¨ Ø¹Ù„Ù‰ Ø£ÙŠ Ø´ÙŠØ¡</li>
                <li>â€¢ <span style="color: #6b21a8">Ø¨Ø·Ø§Ù‚Ø§Øª ØªØºÙŠÙŠØ±</span>: ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</li>
              </ul>
            </div>
            
            <div class="bg-yellow-50 p-5 rounded-xl">
              <h3 class="font-bold text-xl mb-3">âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ù‡Ù…Ø©</h3>
              <ul class="space-y-3 text-gray-700 text-lg">
                <li>â€¢ <strong>Ø£Ø¹Ù„Ù† Ø¹Ù† "Ø¢Ø®Ø± Ø¨Ø·Ø§Ù‚ØªÙŠÙ†"</strong> Ø¹Ù†Ø¯Ù…Ø§ ØªØ¨Ù‚Ù‰ Ù„Ùƒ Ø¨Ø·Ø§Ù‚ØªØ§Ù† ÙÙ‚Ø·</li>
                <li>â€¢ <strong>Ø¥Ø°Ø§ Ù†Ø³ÙŠØª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</strong>ØŒ Ø³ØªØ³Ø­Ø¨ Ø¨Ø·Ø§Ù‚ØªÙŠÙ† Ø¹Ù‚ÙˆØ¨Ø©</li>
                <li>â€¢ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø©ØŒ ÙŠØªÙ… Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</li>
              </ul>
            </div>
          </div>
          
          <button onclick="closeModal()" class="w-full mt-8 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg">
            ÙÙ‡Ù…ØªØŒ Ø´ÙƒØ±Ø§Ù‹!
          </button>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // ==================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ====================
    function hideAllScreens() {
      const screens = [
        'startScreen', 'namesScreen', 'gameScreen', 'loginScreen',
        'registerScreen', 'forgotPasswordScreen', 
        'resetPasswordScreen'
      ];
      screens.forEach(screenId => {
        const screen = document.getElementById(screenId);
        if (screen) {
          screen.classList.add('hidden');
        }
      });
      
      closeModal();
      closeTermsModal();
      closePrivacyModal();
      
      const waitingScreen = document.getElementById('waitingScreen');
      if (waitingScreen) {
        waitingScreen.remove();
      }
    }
    
    // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ====================
    document.addEventListener('DOMContentLoaded', () => {
      detectDevicePerformance();
      
      initMusicSystem();
      
      updateMusicButtons();
      
      let userInteracted = false;
      
      const enableAudio = function() {
        if (!userInteracted) {
          userInteracted = true;
          document.body.classList.add('user-interacted');
          console.log('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
          
          if (musicEnabled) {
            setTimeout(() => {
              playMainMenuMusic();
              updateMusicButtonVisibility();
            }, 500);
          }
          
          document.removeEventListener('click', enableAudio);
          document.removeEventListener('keydown', enableAudio);
          document.removeEventListener('touchstart', enableAudio);
        }
      };
      
      document.addEventListener('click', enableAudio);
      document.addEventListener('keydown', enableAudio);
      document.addEventListener('touchstart', enableAudio);
      
      const logoImg = document.querySelector('#loadingScreen img');
      if (logoImg) {
        logoImg.classList.add('logo-spinner');
      }
      
      document.getElementById('registerPassword')?.addEventListener('input', function() {
        checkPasswordStrength(this.value);
      });
      
      document.getElementById('resetNewPassword')?.addEventListener('input', function() {
        checkResetPasswordStrength(this.value);
      });
      
      document.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          if (document.getElementById('loginScreen') && 
              !document.getElementById('loginScreen').classList.contains('hidden')) {
            loginUser();
          } else if (document.getElementById('registerScreen') && 
              !document.getElementById('registerScreen').classList.contains('hidden')) {
            registerUser();
          } else if (document.getElementById('forgotPasswordScreen') && 
              !document.getElementById('forgotPasswordScreen').classList.contains('hidden')) {
            sendResetLink();
          } else if (document.getElementById('resetPasswordScreen') && 
              !document.getElementById('resetPasswordScreen').classList.contains('hidden')) {
            resetPassword();
          }
        }
      });
      
      preloadAllGameImages().then(() => {
        console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­');
        
        initSDKs();
        
        initAuthSystem();
        
        setTimeout(() => {
          const helpButton = document.getElementById('helpButton');
          if (helpButton && allImagesLoaded) {
            helpButton.classList.remove('hidden');
            helpButton.style.opacity = '1';
            helpButton.style.transform = 'translateY(0)';
          }
          
          updateMusicButtonVisibility();
          
        }, 1000);
        
      }).catch(error => {
        console.error('âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±:', error);
        setTimeout(() => {
          hideImageLoadingScreen();
          initSDKs();
          allImagesLoaded = true;
          updateStartButton();
          
          initAuthSystem();
          
          updateMusicButtonVisibility();
        }, 1000);
      });
    });
  </script>
</body>
</html>